<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Geek Spirit">
<meta property="og:type" content="website">
<meta property="og:title" content="qicainiao&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="qicainiao&#39;s Blog">
<meta property="og:description" content="Geek Spirit">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="qicainiao&#39;s Blog">
<meta name="twitter:description" content="Geek Spirit">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>qicainiao's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">qicainiao's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Geek Spirit</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/30/react性能优化/手把手测试react性能/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/30/react性能优化/手把手测试react性能/" itemprop="url">手把手测试react性能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-30T17:19:27+08:00">
                2019-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">react性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在最近的工作中我们发现开发一个已经持续开发了一年的React应用在IE11浏览器和一个老旧的安卓设备上工作不是特别流畅，这引起了我们的注意，决定抽出一些精力对代码做一些优化。虽然我们在日常开发中已经有意识的去写高质量、高效率的代码，但是由于开发人员的计算机性能都很好并且经常调试使用的chrome浏览器有一个强大的V8引擎所以性能问题还是经常会被忽略。</p>
<p>我是如何用React Profile发现问题，并分析解决问题的。</p>
<h2 id="分析工具"><a href="#分析工具" class="headerlink" title="分析工具"></a>分析工具</h2><p>性能问题通常是在手动测试或调试时直观感受到的，例如做某些操作时应用出现卡顿或是移动设备发热的情况。但是在这种情况下不太容找到问题到底出在哪些组件中，很多时候新添加的代码并不一定是问题的原因有可能只是个诱因。这时分析工具就非常有用了，可以帮助我们定位问题点。在这篇文章我用React+Redux的Todos例子作为演示代码。</p>
<h3 id="React-DevTools"><a href="#React-DevTools" class="headerlink" title="React DevTools"></a>React DevTools</h3><p>这应该是每个React开发者必备工具</p>
<h3 id="Highlight-Updates"><a href="#Highlight-Updates" class="headerlink" title="Highlight Updates"></a>Highlight Updates</h3><p>这是DevTools里提供的一个功能，在我们操作React App时可以高亮重新渲染的组件。</p>
<p>打开高亮功能</p>
<p><img src="/images/react/1.png" alt></p>
<p>使用<br>打开之后当操作App时重新渲染的组件会有一个高亮的边框，边框为蓝色时说明渲染时间短，黄色说明时间有点长，如果时间很长会是红色就要注意了。这个工具会给我们一个直观的显示哪些组件更新了。</p>
<p><img src="/images/react/2.gif" alt></p>
<h3 id="React-Profiler"><a href="#React-Profiler" class="headerlink" title="React Profiler"></a>React Profiler</h3><p>这个工具包含在React DevTools中，适用于react 16.5及之后版本。如果你的项目版本合适，会在DevTools里看到Profiler页。</p>
<p><img src="/images/react/3.png" alt></p>
<h2 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a>分析问题</h2><p>使用工具<br>点Profiler右上角的圆形按钮开始记录分析数据，然后在todos上添加3个新的todo项，完成操作之后再点圆形按钮结束录制。</p>
<p>从App上可以看到，每当添加新的todo项时，整个todo列表和每一个todo项都重新渲染了。 </p>
<p><img src="/images/react/4.gif" alt></p>
<p>然后看看Profiler中的数据。</p>
<p><img src="/images/react/5.png" alt></p>
<p>React渲染组件主要分两个阶段：渲染（Render）和提交（commit）。渲染阶段react执行组件中的render方法得到渲染结果也就是虚拟DOM，然后和上一次渲染的结果比较找出差异。提交阶段，react会添加、更新或删除真实DOM，把虚拟DOM中的内容渲染到页面中。</p>
<p><img src="/images/react/6.png" alt></p>
<p>右上角的1/3表示在录制过程中一共有3次提交，图中的每一个小条代表一次提交，黑色的是当前选中的提交，点击不同的条可以选择不同的提交。小条的高度和颜色反应了提交执行的时间，黄色高的条比蓝色条用的时间长。</p>
<p><img src="/images/react/7.png" alt></p>
<p>这部分是火焰图🔥，每一个小块对应一个组件，块的长度、颜色和组件渲染所用时间有关，黄色长的块说明消耗的时间更长。灰色说明这个组件在这次提交中没有重新渲染。这里显示的组件渲染时间是它自身渲染的时间和它所有子组件渲染时间的综合。</p>
<p><img src="/images/react/9.gif" alt></p>
<p>找到花费时间长的组件</p>
<p><img src="/images/react/10.png" alt></p>
<p>为了让问题更明显我加了30个todo到列表中，从图中很容易发现大部分时间都花在TodoList这个组件上。这个图里有一个容易产生困惑的地方就是Total Renders，这个数字代表的是这个组件在整个App生命周期里被渲染的次数，而不是在这次commit中被渲染的次数。</p>
<p>和之前只有3个todo时相比较，TodoList这个组件的渲染时间随着todo数量的增加而增加，因为每次渲染列表时每个todo都重新渲染了。而这些渲染并不是必要，因为每个新todo都是添加到列表末尾，之前的todo位置和内容都没有变化应该可以不再渲染。</p>
<p><img src="/images/react/11.gif" alt></p>
<p>点击第一个todo组件，然后切换不同的commit发现todo的props一直没有变化，这也证明了我们之前的想法是正确的。</p>
<h2 id="改进方法"><a href="#改进方法" class="headerlink" title="改进方法"></a>改进方法</h2><p>使用React.PureComponent或React.memo()避免不必要的组件重渲染<br>React.PureComponent和React.Component类似，但是React.PureComponent在shouldComponentUpdate()中对props和state做了一个浅比较，如果props和state没有变化则不渲染组件。</p>
<p>React.memo()是16.8版本加入的新功能，为使用函数定义的组件提供了类似PureComponent的功能。</p>
<p>本例中的Todo组件使用函数方式定义的，所以把最后一行使用React.memo()重写为 export default React.memo(Todo)</p>
<p>重写后的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;</span><br><span class="line">import PropTypes from &apos;prop-types&apos;</span><br><span class="line"></span><br><span class="line">const Todo = (&#123; onClick, completed, text &#125;) =&gt; (</span><br><span class="line">  &lt;li</span><br><span class="line">    onClick=&#123;onClick&#125;</span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">      textDecoration: completed ? &apos;line-through&apos; : &apos;none&apos;</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;text&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Todo.propTypes = &#123;</span><br><span class="line">  onClick: PropTypes.func.isRequired,</span><br><span class="line">  completed: PropTypes.bool.isRequired,</span><br><span class="line">  text: PropTypes.string.isRequired</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default React.memo(Todo);</span><br></pre></td></tr></table></figure>

<p>改过之后重新录制分析数据再来看看，</p>
<p><img src="/images/react/11.png" alt></p>
<p>嗯，并没有什么变化，再次看todo组件的分析数据。<br><img src="/images/react/12.gif" alt></p>
<p>通过比较两次commit，todo的props看上去没有变化，而且todo也没有state。不过进一步观察，props中completed, id, text都是原始类型，我们可以确定他们是没变的。onClick不同，这是一个函数，它是否变化同定义的方式有关。</p>
<p>通过查看代码，发现onClick是一个inline的箭头函数，问题是应该出在这里。</p>
<p>TodoList.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const TodoList = (&#123; todos, toggleTodo &#125;) =&gt; (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;todos.map(todo =&gt;</span><br><span class="line">      &lt;Todo</span><br><span class="line">        key=&#123;todo.id&#125;</span><br><span class="line">        &#123;...todo&#125;</span><br><span class="line">        onClick=&#123;() =&gt; toggleTodo(todo.id)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>不要使用inline定义的方法或Object为props传值<br>修改后的代码如下：</p>
<p>TodoList.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const TodoList = (&#123; todos, toggleTodo &#125;) =&gt; (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;todos.map(todo =&gt;</span><br><span class="line">      &lt;Todo</span><br><span class="line">        key=&#123;todo.id&#125;</span><br><span class="line">        &#123;...todo&#125;</span><br><span class="line">        onClick=&#123;toggleTodo&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>把原先的inline方法去掉，改为直接把toggleTodo传给Todo。</p>
<p>Todo.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const Todo = (&#123; onClick, id, completed, text &#125;) =&gt; &#123;</span><br><span class="line">  function clickHandler() &#123;</span><br><span class="line">    onClick(id)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;li</span><br><span class="line">      onClick=&#123;clickHandler&#125;</span><br><span class="line">      style=&#123;&#123;</span><br><span class="line">        textDecoration: completed ? &apos;line-through&apos; : &apos;none&apos;</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;text&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Todo.js中定义了一个clickHandler方法，这样todo方法每次重新运行时clickHandler都不会变。</p>
<p><img src="/images/react/13.png" alt></p>
<p>新的分析数据中可以看到前面的todo组件都是灰色说明没有重新渲染，只有最后一个新加的todo被渲染了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/30/react性能优化/react性能优化1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/30/react性能优化/react性能优化1/" itemprop="url">react性能优化一</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-30T17:05:59+08:00">
                2019-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">react性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<h2 id="props尽量只传需要的数据，避免多余的更新"><a href="#props尽量只传需要的数据，避免多余的更新" class="headerlink" title="props尽量只传需要的数据，避免多余的更新"></a>props尽量只传需要的数据，避免多余的更新</h2><h2 id="组件尽量解耦，比如一个input-list组建，可以将list分成一个PureComponent，只在list数据变化是更新"><a href="#组件尽量解耦，比如一个input-list组建，可以将list分成一个PureComponent，只在list数据变化是更新" class="headerlink" title="组件尽量解耦，比如一个input+list组建，可以将list分成一个PureComponent，只在list数据变化是更新"></a>组件尽量解耦，比如一个input+list组建，可以将list分成一个PureComponent，只在list数据变化是更新</h2><h2 id="如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index"><a href="#如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index" class="headerlink" title="如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index"></a>如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/29/hexo静态网站/Hexo+NexT 添加分类、标签、关于菜单项/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/29/hexo静态网站/Hexo+NexT 添加分类、标签、关于菜单项/" itemprop="url">hexo搭建静态网站-Hexo+NexT 添加分类、标签、关于菜单项</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-29T10:20:09+08:00">
                2019-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo搭建静态网站/" itemprop="url" rel="index">
                    <span itemprop="name">hexo搭建静态网站</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>极简风格博客 =windows + hexos + github<br>Hexo NexT主题下默认有首页和归档两个菜单，我们还可以开启其他菜单项，比如分类、标签、关于<br>这是这篇教程的成品图</p>
<p><img src="/images/hexo/2-1.png" alt></p>
<p>首先打开主题下的配置文件_config.yml，然后搜索menu找到如下配置项，将about、tags、categories前的#号去掉，就开启了关于、标签和分类标签，当然还有其他菜单项也可以开启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Menu Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash from link value (/archives -&gt; archives).</span></span><br><span class="line"><span class="comment"># Usage: `Key: /link/ || icon`</span></span><br><span class="line"><span class="comment"># Key is the name of menu item. If the translation for this item is available, the translated text will be loaded, otherwise the Key name will be used. Key is case-senstive.</span></span><br><span class="line"><span class="comment"># Value before `||` delimiter is the target link.</span></span><br><span class="line"><span class="comment"># Value after `||` delimiter is the name of FontAwesome icon. If icon (with or without delimiter) is not specified, question icon will be loaded.</span></span><br><span class="line"><span class="comment"># External url should start with http:// or https://</span></span><br><span class="line">menu:</span><br><span class="line">  home: / || home</span><br><span class="line">  about: /about/ || user</span><br><span class="line">  tags: /tags/ || tags</span><br><span class="line">  categories: /categories/ || th</span><br><span class="line">  archives: /archives/ || archive</span><br><span class="line">  <span class="comment">#schedule: /schedule/ || calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || sitemap</span></span><br></pre></td></tr></table></figure>

<p>重新生成部署后，可以看到新增的菜单项，但是单击后会报如下错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cannot GET /about/</span><br><span class="line">Cannot GET /tags/</span><br><span class="line">Cannot GET /categories/</span><br></pre></td></tr></table></figure>

<p>这是因为你还需运行如下命令新建相关页面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new page <span class="string">"about"</span></span><br><span class="line">hexo new page <span class="string">"tags"</span></span><br><span class="line">hexo new page <span class="string">"categories"</span></span><br></pre></td></tr></table></figure>

<p>运行结果如下，会再source文件下创建about、tags、categories文件夹，每个文件夹下还会创建一个index.md文件表示关于、标签页分类页面，编辑这三个MarkDown文件可以自定义这三个页面的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D:\hexo\blog&gt;hexo new page <span class="string">"about"</span></span><br><span class="line">INFO  Created: D:\hexo\blog\<span class="built_in">source</span>\about\index.md</span><br><span class="line"> </span><br><span class="line">D:\hexo\blog&gt;hexo new page <span class="string">"tags"</span></span><br><span class="line">INFO  Created: D:\hexo\blog\<span class="built_in">source</span>\tags\index.md</span><br><span class="line"> </span><br><span class="line">D:\hexo\blog&gt;hexo new page <span class="string">"categories"</span></span><br><span class="line">INFO  Created: D:\hexo\blog\<span class="built_in">source</span>\categories\index.md</span><br></pre></td></tr></table></figure>

<p>还差最后一步，打开各页面对应的index.md文件，编辑如下内容，title和date是默认生成的，增加type即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2019-08-29 09:50:23</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"about"</span></span><br><span class="line">---</span><br><span class="line"> </span><br><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2019-08-29 09:50:23</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"tags"</span></span><br><span class="line">---</span><br><span class="line"> </span><br><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2019-08-29 09:50:23</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"categories"</span></span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>重新生成和部署即可看到效果</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/29/hexo静态网站/搭建github博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/29/hexo静态网站/搭建github博客/" itemprop="url">hexo搭建静态网站-搭建github博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-29T10:15:31+08:00">
                2019-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo搭建静态网站/" itemprop="url" rel="index">
                    <span itemprop="name">hexo搭建静态网站</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>极简风格博客 =windows + hexos + github<br>这是这篇教程的成品图</p>
<p><img src="/images/hexo/1-1.png" alt></p>
<p>#博客搭建分为三步：#</p>
<ul>
<li>创建github域名及空间</li>
<li>git，nodejs，hexo下载及安装</li>
<li>配置环境</li>
</ul>
<p>##1.创建github域名及空间<br>进入github官网，注册并登录。<br>登录后，点击右上角的 “+” 号，选择 “new repository” , 会出现以下界面：</p>
<p><img src="/images/hexo/1-2.png" alt></p>
<p>在 repository name 中填入 username.github.io 。（username指的是前面owner的用户名，比如我这里应该填 wenjie710.github.io 。）<br>然后点击最下面的create repository 即可。<br>2.安装 git，nodejs，hexo<br>下载地址：<br>git官网下载：<a href="https://git-scm.com/download/win" target="_blank" rel="noopener">https://git-scm.com/download/win</a><br>nodejs官网下载：<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a><br>以上两个工具都是直接下载的exe文件，点击安装即可。安装完成之后在文件夹中点击鼠标右键会看到下拉菜单中有一个 Git Bash ，这是一个类似于Liunx的终端，在里面可以模拟Linux下的终端进行操作。<br>git 和 nodejs 安装完成之后才能安装hexo。hexo的安装十分简单，只需要在命令提示符（cmd）中输入以下命令即可。</p>
<pre><code>npm install -g hexo-cli</code></pre><p>3.配置环境<br>3.1 配置ssh<br>打开 Git Bash ，执行下面的命令生成 SSH 访问私钥及公钥。</p>
<pre><code>ssh-keygen -t rsa -C &quot;email@email.com&quot;</code></pre><p>输入命令回车之后会提示你输入一些东西，不用管。一直回车到底就好了。然后你的 ~/.ssh 文件下就会生成两个文件 id_rsa 和 id_rsa.pub 。</p>
<p><img src="/images/hexo/1-3.png" alt></p>
<p>打开你的 Github -&gt; setting -&gt; SSH Keys 。然后点击 New SSH Key 创建一个新的SSH Key。将文件 id_rsa.pub 中的所以内容复制粘贴到 Key 下面。然后使用下面的命令测试是否可以连接上 Github.</p>
<pre><code>ssh -T git@github.com</code></pre><p>3.2 编写配置，发布博客<br>3.2.1 主题安装<br>新建一个用以存储博客的文件夹</p>
<pre><code>hexo init username@github.io</code></pre><p>安装主题，推荐 next， 其它也行，可以自己选选。</p>
<pre><code>cd username@github.io
git clone https://github.com/iissnan/hexo-theme-next themes/next</code></pre><p>3.2.2 自定义配置文件<br>打开 username.github.io/_config.yml ，修改以下键值对(注意冒号之后一定要有空格）：</p>
<pre><code>title: GA-17&apos;s Blog
subtitle:
description: Hello World!
author: GA-17
language: zh-Hans
theme: next
deploy:
  type: git
  repo: https://github.com/wenjie710/wenjie710.github.io.git
  branch: master</code></pre><p>3.2.3 配置完成，写文章！！！<br>在username.github.io/source/_posts下创建你的第一个博客吧，例如，创建一个名为FirstBlog.md的文件，格式用Markdown，注意保存。</p>
<pre><code>---
title: My First Blog
---</code></pre><p>咱的博客搭建完成啦！！</p>
<p>3.2.4 发布<br>安装hexo-deployer-git自动部署发布工具</p>
<pre><code>npm install hexo-deployer-git --save</code></pre><p>发布博客</p>
<pre><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d

# hexo clean 清除缓存
# hexo g 生成静态页面
# hexo s 启动服务预览
# hexo d 开始部署</code></pre><p>如果这是第一次登录，终端会让你输入Github 的邮箱和密码，正确输入后，就会把你的博客上传至Github 了。以后在每次把博客写完后，执行一下这个命令即可。<br>至此，博客搭建完成。进入<a href="https://username.github.io" target="_blank" rel="noopener">https://username.github.io</a> 就能看见自己的博客啦！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/webpack性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/webpack性能优化/" itemprop="url">webpack系列-webpack性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T18:41:57+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们在打包的时候需要耗费非常多的时间，所以在一些大型项目的时候需要提升webpack的打包效率。</p>
<h2 id="跟上技术的迭代（node-npm-yarn）"><a href="#跟上技术的迭代（node-npm-yarn）" class="headerlink" title="跟上技术的迭代（node,npm,yarn）"></a>跟上技术的迭代（node,npm,yarn）</h2><p>　升级webpack，node，npm，yarn的版本。新的版本会做优化</p>
<h2 id="在尽可能少的模块上应用Loader"><a href="#在尽可能少的模块上应用Loader" class="headerlink" title="在尽可能少的模块上应用Loader"></a>在尽可能少的模块上应用Loader</h2><p>比如曾经有个功能将this指向window的功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rules:[&#123;</span><br><span class="line">　　use:[&#123;</span><br><span class="line">　　　　loader: <span class="string">'imports-loader?this=&gt;window'</span></span><br><span class="line">　　&#125;]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>这个时候可以把他干掉，作用不大。<br>比如js打包一定要加exclude:/node_modules/</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rules:[&#123;</span><br><span class="line">　　<span class="built_in">test</span>:/\.js$/,</span><br><span class="line">　　exclude:/node_modules/</span><br><span class="line">　　use:[[</span><br><span class="line">　　　　loader:<span class="string">'babel-loader'</span></span><br><span class="line">　　]]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>node_modules的第三方模块都是编译过，不需要二次打包，合理使用exclude,include</p>
<h2 id="尽可能少的使用plugin，同时确保plugin的可靠性。"><a href="#尽可能少的使用plugin，同时确保plugin的可靠性。" class="headerlink" title="尽可能少的使用plugin，同时确保plugin的可靠性。"></a>尽可能少的使用plugin，同时确保plugin的可靠性。</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const MiniCssExtractPlugin = require(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins:[</span><br><span class="line">　　　　new MiniCssExtractPlugin(&#123;&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>比如上线的时候使用OptimizeCSSAssetsPlugin，压缩css的插件。希望在打包生成代码的时候，如果我引入了css文件，那么把css文件打包到dist目录下。而不是直接引入到js文件里面。如果是开发环境，就不需要使用这个插件，不对代码进行压缩，就节约了代码打包压缩的时间。所以插件尽量使用官方的插件，官方的插件是经过官网测试的，在自己引用第三方插件的时候，也需要是社区里经过测试的。可以有效提升webpack打包速度。</p>
<h2 id="resolve参数合理配置"><a href="#resolve参数合理配置" class="headerlink" title="resolve参数合理配置"></a>resolve参数合理配置</h2><p>比如我们之前引入一个js文件的时候，是这样的，import Child from ‘../child/child’。<br>后面没有加js后缀也可以引入。在一开始的时候是不支持这样引入的。可以引入是因为webpack下有这么一段代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　extensions: [<span class="string">'./js'</span>, <span class="string">'.jsx'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当看到resolve可以这么配，就想好多东西都配置在这里</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　extensions: [<span class="string">'./css'</span>, <span class="string">'./jpg'</span>, <span class="string">'./js'</span>, <span class="string">'.jsx'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就意味着很多次查找，每次查找的时候一般会损耗性能的。一般js,jsx的时候配置resolve，其他手动写后缀去引入。</p>
<p>resolve还有其他的用法，比如src/child/child这样引入。import Child from ‘./child/‘这样也可以引入child.js文件，本身这样引入是不行的，如果把child.js改成index.js也可以，但是现在是child.js，不是index.js怎么弄</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　extensions: [<span class="string">'./js'</span>, <span class="string">'.jsx'</span>],</span><br><span class="line">　　mainFiles: [<span class="string">'index'</span>, <span class="string">'child'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>他的意思是引入某个目录下不知道什么文件的时候，首先会先尝试去找index文件，如果index文件不存在再去找child文件。这样额外配置resolve里面的内容也会有影响，一般我们不这样配。</p>
<p>resolve还有其他的配置项。比如alias，当文件比较深的时候可以引入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　<span class="built_in">alias</span>: &#123;</span><br><span class="line">　　　　child: path.resolve(__dirname, <span class="string">'../src/a/b/c'</span>)</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在文件中直接 import Child from ‘child/xxx.js’就可以了。</p>
<h2 id="使用DllPlugin提高打包速度"><a href="#使用DllPlugin提高打包速度" class="headerlink" title="使用DllPlugin提高打包速度"></a>使用DllPlugin提高打包速度</h2><p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from <span class="string">'react'</span>;</span><br><span class="line">import &#123; BrowserRouter, Route &#125; from <span class="string">'react-router-dom'</span>;</span><br><span class="line">import ReactDom from <span class="string">'react-dom'</span>;</span><br><span class="line">import _ from <span class="string">'lodash'</span>;</span><br><span class="line"></span><br><span class="line">class App extends Component&#123;</span><br><span class="line">　　<span class="function"><span class="title">render</span></span>() &#123;</span><br><span class="line">　　　　<span class="built_in">return</span> (</span><br><span class="line">　　　　　　&lt;BrowserRouter&gt;</span><br><span class="line">　　　　　　　　&lt;div&gt;</span><br><span class="line">　　　　　　　　　　&#123;_.join([<span class="string">'this'</span>,<span class="string">'is'</span>,<span class="string">'app'</span>], <span class="string">' '</span>)&#125;</span><br><span class="line">　　　　　　　　&lt;/div&gt;</span><br><span class="line">　　　　　　&lt;/BrowserRouter&gt;</span><br><span class="line">　　　　)</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDom.render(&lt;App/&gt;, document.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure>

<p>像lodash这样的第三方模块加进去后，大概打包多了一百多ms。像这种代码不会变多第三方模块，我们不必每次都去打包分析，第二次直接用第一次分析好多结果就好了。首先建立一个webpack.dll.js</p>
<p>webpack.dll.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry:&#123;</span><br><span class="line">　　　　vendors: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>, <span class="string">'lodash'</span>]</span><br><span class="line">　　&#125;,</span><br><span class="line">　　output:&#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].dll.js'</span>,</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'../dll'</span>),</span><br><span class="line">　　　　// 通过一个全局变量暴露出去，全局变量叫做vendors</span><br><span class="line">　　　　library: <span class="string">'[name]'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后配置文件增加一个</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"build:dll"</span>: <span class="string">"webpack --config ./build/webpack.dll.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后我们打包好了一个叫做vendors.dll.js的文件。怎么引用，我们把vendors.dll.js植入到index.html里面，就可以全局引入vendors这个变量</p>
<p>安装一个插件，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install add-asset-html-webpack-plugin --save</span><br></pre></td></tr></table></figure>

<p>顾名思义就是在html里面去增加一些静态的资源.安装好后，配置webpack.common.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const AddAssetHtmlWebpackPlugin = require(<span class="string">'add-asset-html-webpack-plugin'</span>);</span><br><span class="line">plugins: [</span><br><span class="line">　　// filepath表示要增加到文件是哪些</span><br><span class="line">　　new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　filepath: path.resolve(__dirname, <span class="string">'../dll/vendors.dll.js'</span>)</span><br><span class="line">　　&#125;)</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>然后运行npm run dev (“webpack-dev-server –config ./build/webpack.common.js”)。打开控制台，可以看到已经引入了vendors.dll.js。也有了vendors这个全局变量。</p>
<p>到了这一步，离目标近了一步。我们到目标是第三方模块只打包一次。现在我们打包好了第三方模块，可以被使用。但还没有被使用的这一步。接下来我们看怎么使用第三方模块。<br>webpack.dll.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　// 用这个插件分析这个库，把库里面一些第三方模块的映射关系放到了dll下面的vendors.mainfest.json</span><br><span class="line">　　　　new webpack.DllPlugin(&#123;</span><br><span class="line">　　　　　　name: <span class="string">'[name]'</span>,</span><br><span class="line">　　　　　　path: path.resolve(__dirname, <span class="string">'../dll/[name].manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack.common.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　/**</span><br><span class="line">　　　　* 使用这个插件，当打包index.js的时候，会引入一些第三方模块，当发现第三方模块的时候，会去manifest去找映射关系</span><br><span class="line">　　　　* 找到就不用再重新分析打包了，去vendors这个全局变量找就好了</span><br><span class="line">　　　　* 不在第三方模块，才会去分析</span><br><span class="line">　　　　*/</span><br><span class="line">　　　　new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll/vendors.manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后重新打包，看到之前时间是1500ms左右，现在是1100ms左右。 我们也可以对打包的webpack.dll.js进行拆分</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry:&#123;</span><br><span class="line">　　　　vendors: [<span class="string">'lodash'</span>],</span><br><span class="line">　　　　react: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>]</span><br><span class="line">　　&#125;,</span><br><span class="line">　　output:&#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].dll.js'</span>,</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'../dll'</span>),</span><br><span class="line">　　　　// 通过一个全局变量暴露出去，全局变量叫做vendors</span><br><span class="line">　　　　library: <span class="string">'[name]'</span></span><br><span class="line">　　&#125;,</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　// 用这个插件分析这个库，把库里面一些第三方模块的映射关系放到了dll下面的vendors.mainfest.json</span><br><span class="line">　　　　new webpack.DllPlugin(&#123;</span><br><span class="line">　　　　　　name: <span class="string">'[name]'</span>,</span><br><span class="line">　　　　　　path: path.resolve(__dirname, <span class="string">'../dll/[name].manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再执行npm run build:dll（”build:dll”: “webpack –config ./build/webpack.dll.js”）。生成了vendors.dll.js和react.dll.js两个文件。同时webpack.commmon.js也要增加新增的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　　　filepath: path.resolve(__dirname, <span class="string">'../dll/vendors.dll.js'</span>)</span><br><span class="line">　　　　&#125;),</span><br><span class="line">　　　　new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　　　filepath: path.resolve(__dirname, <span class="string">'../dll/react.dll.js'</span>)</span><br><span class="line">　　　　&#125;),</span><br><span class="line">　　　　new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll/vendors.manifest.json'</span>)</span><br><span class="line">　　　　&#125;),</span><br><span class="line">　　　　new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll/react.manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那如果在大型项目中，dll文件就会非常的多，在plugins里面也要不断的加dll.js和mainfest.json。我们这样做个优化</p>
<p>把基础的plugins提取出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const plugins = [</span><br><span class="line">　　// HtmlWebpackPlugin会在打包结束后，自动生成一个html文件，并把打包生成的js自动引入到这个html文件中</span><br><span class="line">　　new HtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　template: <span class="string">'src/index.html'</span></span><br><span class="line">　　&#125;),</span><br><span class="line">　　new CleanWebpackPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>接着通过node分析dll下有几个dll文件，有几个mainfest.json文件。然后动态的往plugins里面添加这个AddAssetHtmlWebpackPlugin和DllReferencePlugin。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 引入node fs</span><br><span class="line">const fs = require(<span class="string">'fs'</span>);</span><br><span class="line">// 读取dll文件的所有文件名</span><br><span class="line">const files = fs.readdirSync(path.resolve(__dirname, <span class="string">'../dll'</span>));</span><br><span class="line">const plugins = [</span><br><span class="line">　　// HtmlWebpackPlugin会在打包结束后，自动生成一个html文件，并把打包生成的js自动引入到这个html文件中</span><br><span class="line">　　new HtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　template: <span class="string">'src/index.html'</span></span><br><span class="line">　　&#125;),</span><br><span class="line">　　new CleanWebpackPlugin()</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">// 读取dll文件的所有内容</span><br><span class="line">const files = fs.readdirSync(path.resolve(__dirname, <span class="string">'../dll'</span>));</span><br><span class="line"></span><br><span class="line">files.forEach(file =&gt;&#123;</span><br><span class="line">　　// // filepath表示要增加到文件是哪些</span><br><span class="line">　　<span class="keyword">if</span>(/.*\.dll.js/.<span class="built_in">test</span>(file)) &#123;</span><br><span class="line">　　　　plugins.push(new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　　　filepath: path.resolve(__dirname, <span class="string">'../dll'</span>, file)</span><br><span class="line">　　　　&#125;))</span><br><span class="line">　　&#125;</span><br><span class="line">　　// /**</span><br><span class="line">　　// * 使用这个插件，当打包index.js的时候，会引入一些第三方模块，当发现第三方模块的时候，会去mainfest去找映射关系</span><br><span class="line">　　// * 找到就不用再重新分析打包了，去vendors这个全局变量找就好了</span><br><span class="line">　　// * 不在第三方模块，才会去分析</span><br><span class="line">　　// */</span><br><span class="line">　　<span class="keyword">if</span>(/.*\.manifest.json/.<span class="built_in">test</span>(file))&#123;</span><br><span class="line">　　　　plugins.push(new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll'</span>, file)</span><br><span class="line">　　　　&#125;))</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="控制包文件大小-tree-shaking-splitChunks"><a href="#控制包文件大小-tree-shaking-splitChunks" class="headerlink" title="控制包文件大小(tree shaking, splitChunks)"></a>控制包文件大小(tree shaking, splitChunks)</h2><h2 id="thread-loader-parallel-webpack-happypack多进程打包"><a href="#thread-loader-parallel-webpack-happypack多进程打包" class="headerlink" title="thread-loader,parallel-webpack,happypack多进程打包"></a>thread-loader,parallel-webpack,happypack多进程打包</h2><h2 id="合理使用sourceMap，soureMap越详细，打包速度越慢"><a href="#合理使用sourceMap，soureMap越详细，打包速度越慢" class="headerlink" title="合理使用sourceMap，soureMap越详细，打包速度越慢"></a>合理使用sourceMap，soureMap越详细，打包速度越慢</h2><h2 id="结合stats，打包分析工具分析打包结果"><a href="#结合stats，打包分析工具分析打包结果" class="headerlink" title="结合stats，打包分析工具分析打包结果"></a>结合stats，打包分析工具分析打包结果</h2><h2 id="开发环境内存编译-devServer，内存的读取比硬盘读取快"><a href="#开发环境内存编译-devServer，内存的读取比硬盘读取快" class="headerlink" title="开发环境内存编译(devServer，内存的读取比硬盘读取快)"></a>开发环境内存编译(devServer，内存的读取比硬盘读取快)</h2><h2 id="开发环境无用插件剔除（比如开发环境，mode不要用production）"><a href="#开发环境无用插件剔除（比如开发环境，mode不要用production）" class="headerlink" title="开发环境无用插件剔除（比如开发环境，mode不要用production）"></a>开发环境无用插件剔除（比如开发环境，mode不要用production）</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/22webpack中第三方库library的打包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/22webpack中第三方库library的打包/" itemprop="url">webpack系列-22webpack中第三方库library的打包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T18:33:41+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前都是对自己写的业务代码进行打包，但假设我们要开发一个库，这样的库代码如何用webpack进行打包呢，首先我们创建一个非常简单的函数库</p>
<p>首先新建一个文件夹library，运行npm init -y，得到一个package.json<br>package.json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">　　<span class="string">"name"</span>: <span class="string">"library"</span>,</span><br><span class="line">　　<span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">　　<span class="string">"description"</span>: <span class="string">""</span>,</span><br><span class="line">　　<span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">　　<span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　&#125;,</span><br><span class="line">　　<span class="string">"keywords"</span>: [],</span><br><span class="line">　　<span class="string">"author"</span>: <span class="string">""</span>,</span><br><span class="line">　　<span class="string">"license"</span>: <span class="string">"MIT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后library下新建一个src,里面建三个文件,math.js,string.js,index.js</p>
<p>math.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> add(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> minus(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> cheng(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> chu(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a / b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>string.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> join(a, b)&#123;</span><br><span class="line">　　<span class="built_in">return</span> a + <span class="string">''</span> + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import * as math from <span class="string">'./math'</span>;</span><br><span class="line">import * as string from <span class="string">'./string'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> default &#123; math, string &#125;</span><br></pre></td></tr></table></figure>

<p>然后安装webpack</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli --save</span><br></pre></td></tr></table></figure>

<p>新建配置文件 webpack.config.js<br>webpack.config.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>package.json里面配置script</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后运行 npm run build。生成一个dist文件夹，里面生成了一个library.js。如果是我们业务代码，就好了。但是我们生成的是一个库，给别人用的，那么别人怎么用呢</p>
<p>第一种</p>
<p>import library from ‘library’;<br>第二种<br>const library = require(‘library’);<br>第三种</p>
<p>require([‘library’],function() {<br>})<br>如果我们的库想外面可以被这样引用。可以做一个配置,webpack.config.js里面output多加一个参数<br>webpack.config.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span>,</span><br><span class="line">　　　　// 通过任何形式，都可以引用的到</span><br><span class="line">　　　　libraryTarget: <span class="string">'umd'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了这种引用之外，我还希望别人通过引用srcipt后，可以通过全局变量来使用这个库</p>
<script src="library.js"></script>
<p>library.add();<br>再配置一下webpack.config.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span>,</span><br><span class="line">　　　　// 打包生成的代码挂载到页面到一个全局变量上</span><br><span class="line">　　　　library: <span class="string">'library'</span>,</span><br><span class="line">　　　　// 通过任何形式，都可以引用的到</span><br><span class="line">　　　　libraryTarget: <span class="string">'umd'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们做一个测试，在生成好的dist目录下新建index.html</p>
<p>index.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">　　&lt;head&gt;</span><br><span class="line">　　　　&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">　　　　&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">　　　　&lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">　　　　&lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">　　　　&lt;script src=<span class="string">"./library.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">　　&lt;/head&gt;</span><br><span class="line">　　&lt;body&gt;</span><br><span class="line">　　&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>然后运行这个页面，控制台调用library;</p>
<p>除了在打包库的时候，我们要额外的配置这两个参数之外呢，我们还要做一件事情。比如string.js<br>string.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> join(a, b)&#123;</span><br><span class="line">　　<span class="built_in">return</span> a + <span class="string">''</span> + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在写的时候发现lodash里面有个功能很好</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install lodash --save</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import _ from <span class="string">'lodash'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> join(a, b)&#123;</span><br><span class="line">　　<span class="built_in">return</span> _.join([a,b], <span class="string">' '</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后现在看起来没有问题，但是别人使用我们的库的时候，他也有可能重新使用了lodash。这就导致一个问题，我们的库里面打包了一次lodash，用户的业务代码里面又打包了一次lodash。所以用户的业务代码里面就容易存在两份lodash代码。为了解决这个问题，我们需要在库里面做一个另外的配置，externals</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　// 如果打包过程中遇到lodash，就忽略这个库，不要打包到代码里面去</span><br><span class="line">　　externals: [<span class="string">'lodash'</span>],</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span>,</span><br><span class="line">　　　　// 打包生成的代码挂载到页面到一个全局变量上</span><br><span class="line">　　　　library: <span class="string">'library'</span>,</span><br><span class="line">　　　　// 通过任何形式，都可以引用的到</span><br><span class="line">　　　　libraryTarget: <span class="string">'umd'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候外面直接使用library就不可以了，因为库里面要用lodash。所以在用这个库的时候，业务代码里面要另外引入lodash。</p>
<p>现在我们看下externals的作用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">externals : &#123;</span><br><span class="line">　　lodash : &#123;</span><br><span class="line">　　　　commonjs: <span class="string">'lodash'</span>,</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这个意思是。如果lodash这个库在commonjs环境下被使用，lodash加载的时候，名字必须是lodash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const lodash = require(<span class="string">'lodash'</span>);</span><br><span class="line"></span><br><span class="line">externals : &#123;</span><br><span class="line">　　lodash : &#123;</span><br><span class="line">　　　　root: <span class="string">'_'</span>,</span><br><span class="line">　　　　commonjs: <span class="string">'lodash'</span>,</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这个时候加一个root。这个意思是如果既不使用commonjs，也不使用es module。更不用amd形式去引入lodash。这个lodash是通过js引入的，这里要求这个script标签必须注入一个叫做’_’的全局变量。但是一般来说没有特殊要求，直接配置成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">externals : &#123;</span><br><span class="line">　　lodash :<span class="string">'lodash'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>就可以了，他的意思是不管任何环境下，引入lodash都叫做lodash。</p>
<p>最终我们给别人使用的是最后的library,那怎么样让别人方便的使用到呢？<br>首先把package.json里面的入口文件配置改成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"main"</span>: <span class="string">"./dist/library.js"</span>,</span><br></pre></td></tr></table></figure>

<p>然后npm里面注册一个账号。登录后在命令行输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm adduser</span><br></pre></td></tr></table></figure>

<p>输入账号密码后，直接输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure>

<p>成功后，别人利用npm install library就可以用你的了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/21webpack中环境变量的使用方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/21webpack中环境变量的使用方法/" itemprop="url">webpack系列-21webpack中环境变量的使用方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T18:31:00+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在webpack打包过程中，怎么去使用一些环境变量。<br>首先我有一个打包配置的三个文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"dev-build"</span>: <span class="string">"webpack --profile --json &gt; stats.json --config ./build/webpack.dev.js"</span>,</span><br><span class="line">　　<span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config ./build/webpack.dev.js"</span>,</span><br><span class="line">　　<span class="string">"build"</span>: <span class="string">"webpack --config ./build/webpack.prod.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>对应三个命令，分别是开发环境的一个命令 npm run dev。打包生成开发环境代码的命令 npm run dev-build。以及线上代码生成的一个命令 npm run build。现在我要借助两个配置文件来帮助我们去完成对应的打包，分别是dev对应配置文件和prod对应的配置文件。现在我可以通过另外一种形式来对代码进行一次变更。</p>
<p>webpack.dev.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">const merge = require(<span class="string">'webpack-merge'</span>);</span><br><span class="line">const commonConfig = require(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const devConfig = &#123;　　</span><br><span class="line">　　mode: <span class="string">'development'</span>,</span><br><span class="line">　　devtool: <span class="string">'cheap-module-eval-source-map'</span>,</span><br><span class="line">　　devServer: &#123;</span><br><span class="line">　　　　contentBase:<span class="string">'./dist'</span>,</span><br><span class="line">　　　　open:<span class="literal">true</span>,</span><br><span class="line">　　　　hot: <span class="literal">true</span></span><br><span class="line">　　&#125;,</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　new webpack.HotModuleReplacementPlugin()</span><br><span class="line">　　],</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].js'</span>,</span><br><span class="line">　　　　chunkFilename: <span class="string">'[name].chunk.js'</span>,</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = merge(commonConfig, devConfig);</span><br></pre></td></tr></table></figure>

<p>这是dev配置原始文件，其中引入了merge和commonConfig。现在我把他删掉，直接导出devConfig</p>
<p>webpack.dev.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">const devConfig = &#123;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = devConfig;</span><br></pre></td></tr></table></figure>

<p>prod也做同样的处理，这样我导出的就不是融合过后的文件。而是自己独立的配置文件。接着我们打开webpack.common.js，去引入merge，dev和prod</p>
<p>webpack.common.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">const HtmlWebpackPlugin = require(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line">const CleanWebpackPlugin = require(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">const merge = require(<span class="string">'webpack-merge'</span>);</span><br><span class="line">const devConfig = require(<span class="string">'./webpack.dev'</span>);</span><br><span class="line">const prodConfig = require(<span class="string">'./webpack.prod'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const commonConfig = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = (env) =&gt; &#123;</span><br><span class="line">　　// 如果有这个全局变量，且是线上环境，否则是开发环境</span><br><span class="line">　　<span class="keyword">if</span>(env &amp;&amp; env.production) &#123;</span><br><span class="line">　　　　<span class="built_in">return</span> merge(commonConfig, prodConfig);</span><br><span class="line">　　&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">　　　　<span class="built_in">return</span> merge(commonConfig, devConfig);</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以前我们导出一个对象，这里我们导出一个函数，接收一个全局变量，怎么融合取决于传递进来的变量。是否有全局变量，是哪个环境决定</p>
<p>package.json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"dev-build"</span>: <span class="string">"webpack --profile --json &gt; stats.json --config ./build/webpack.common.js"</span>,</span><br><span class="line">　　<span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config ./build/webpack.common.js"</span>,</span><br><span class="line">　　<span class="string">"build"</span>: <span class="string">"webpack --env.production --config ./build/webpack.common.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>package.json里面走的都是webpack.common.js了。在build里面加入–env.production。其他不加默认走devConfig。各自运行。没问题。这样就不是通过不同的文件，而是都是走common，通过变量控制</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/19webpack与浏览器缓存，如果文件没有动打包hash那么不变/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/19webpack与浏览器缓存，如果文件没有动打包hash那么不变/" itemprop="url">webpack系列-19webpack与浏览器缓存</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T17:56:01+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>根据之前的配置，假设文件上传至服务器中，没有加hash，如果页面内容有更改，浏览器刷新的时候，请求的还是原先的文件，也就是浏览器的缓存，因为名字没有变。现在我们在上线的webpack配置中加上hash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output:&#123;</span><br><span class="line">　　filename: <span class="string">'[name].[contenthash].js'</span>,</span><br><span class="line">　　chunkFilename: <span class="string">'[name].[contenthash].js'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候打包出来的文件就有了hash值。只要文件内容不变，hash值就不变，内容变了才变。</p>
<p>如果打包失效，比如老版本的webpack4。这个时候加一个配置参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">optimization:&#123;</span><br><span class="line">　　runtimeChunk: &#123;</span><br><span class="line">　　　　name: <span class="string">'runtime'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/18webpack中css文件的代码分割和压缩/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/18webpack中css文件的代码分割和压缩/" itemprop="url">webpack系列-18webpack中css文件的代码分割</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T17:47:20+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].js'</span>,</span><br><span class="line">　　　　chunkFilename: <span class="string">'[name].chunk.js'</span>,</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'../dist'</span>)</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在看别人写的webpack，output配置项，肯跟会碰到chunkFilename这样的配置项，那这个是什么意思呢？filename和chunkFilename有什么区别呢？首先看个例子</p>
<p>index.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">　　&lt;head&gt;</span><br><span class="line">　　　　&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">　　　　&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">　　　　&lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">　　　　&lt;title&gt;html template&lt;/title&gt;</span><br><span class="line">　　&lt;/head&gt;</span><br><span class="line">　　&lt;body&gt;</span><br><span class="line">　　　　&lt;div id=<span class="string">'root'</span>&gt;&lt;/div&gt;</span><br><span class="line">　　&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">async <span class="keyword">function</span> <span class="function"><span class="title">getComponent</span></span>() &#123;</span><br><span class="line">　　const &#123; default: _ &#125; = await import(/* webpackChunkName:<span class="string">'lodash'</span> */<span class="string">'lodash'</span>);</span><br><span class="line">　　const element = document.createElement(<span class="string">'div'</span>);</span><br><span class="line">　　element.innerHTML = _.join([<span class="string">'1'</span>, <span class="string">'2'</span>], <span class="string">'-'</span>);</span><br><span class="line">　　<span class="built_in">return</span> element</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">document.addEventListener(<span class="string">'click'</span>, ()=&gt; &#123;</span><br><span class="line">　　getComponent().<span class="keyword">then</span>( element =&gt;&#123;</span><br><span class="line">　　　　document.body.appendChild(element);</span><br><span class="line">　　&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>webpack.common.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">　　entry: &#123;</span><br><span class="line">　　　　main: <span class="string">'./src/index.js'</span></span><br><span class="line">　　&#125;,</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].js'</span>,</span><br><span class="line">　　　　chunkFilename: <span class="string">'[name].chunk.js'</span>,</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'../dist'</span>)</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行npm run dev-build打包。打开dist目录，发现第三方模块打包好的名字叫vendors<del>lodash.chunk.js，不再是之前的vendors</del>lodash.js。我们的入口文件对应的都是filename的输出。如果不是入口文件，是异步引入或者间接产生的js文件，他就会走chunkFilename这个输出的配置参数。</p>
<p>接下来进入主题，css代码的分割<br>index.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">　　&lt;head&gt;</span><br><span class="line">　　　　&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">　　　　&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">　　　　&lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">　　　　&lt;title&gt;html template&lt;/title&gt;</span><br><span class="line">　　&lt;/head&gt;</span><br><span class="line">　　&lt;body&gt;</span><br><span class="line">　　　　&lt;div id=<span class="string">'root'</span>&gt;&lt;/div&gt;</span><br><span class="line">　　&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import <span class="string">'./style.css'</span>;</span><br><span class="line">console.log(<span class="string">' hello world '</span>);</span><br></pre></td></tr></table></figure>

<p>style.css</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">body&#123;</span><br><span class="line">　　background: <span class="comment">#abcdef;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行npm run dev-build。发现打包生成的文件只有main.js 和 vendors~main.chunk.js。但是浏览器打开index.html。背景已经有了。这是怎么回事呢？webpack在做css的打包的时候，会直接打包到js里面</p>
<p>如果我希望在打包生成代码的时候，如果我引入了css文件，那么把css文件打包到dist目录下。而不是直接引入到js文件里面。那么就需要引入一个插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://webpack.js.org/plugins/mini-css-extract-plugin</span><br><span class="line"></span><br><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>

<p>这个插件可以对css进行代码分割。这个插件不适合开发环境，因为官网说了，这个插件现在还暂时不支持热更新。</p>
<p>安装好之后看怎么使用，首先要在webpack中引入这个插件。首先打开线上配置文件</p>
<p>webpack.prod.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">const merge = require(&apos;webpack-merge&apos;);</span><br><span class="line">const commonConfig = require(&apos;./webpack.common.js&apos;);</span><br><span class="line">const MiniCssExtractPlugin = require(&apos;mini-css-extract-plugin&apos;);</span><br><span class="line"></span><br><span class="line">const prodConfig = &#123;</span><br><span class="line">　　mode: &apos;production&apos;,</span><br><span class="line">　　devtool: &apos;cheap-module-source-map&apos;,</span><br><span class="line">　　module: &#123;</span><br><span class="line">　　　　rules:[&#123;</span><br><span class="line">　　　　　　test: /\.scss$/,</span><br><span class="line">　　　　　　use: [</span><br><span class="line">　　　　　　　　MiniCssExtractPlugin.loader,</span><br><span class="line">　　　　　　　　&#123;</span><br><span class="line">　　　　　　　　　　loader: &apos;css-loader&apos;,</span><br><span class="line">　　　　　　　　　　options: &#123;</span><br><span class="line">　　　　　　　　　　　　importLoaders: 2</span><br><span class="line">　　　　　　　　　　&#125;</span><br><span class="line">　　　　　　　　&#125;,</span><br><span class="line">　　　　　　　　&apos;sass-loader&apos;,</span><br><span class="line">　　　　　　　　&apos;postcss-loader&apos;</span><br><span class="line">　　　　　　]</span><br><span class="line">　　　　&#125;,&#123;</span><br><span class="line">　　　　　　test: /\.css$/,</span><br><span class="line">　　　　　　use: [</span><br><span class="line">　　　　　　　　MiniCssExtractPlugin.loader,</span><br><span class="line">　　　　　　　　&apos;css-loader&apos;,</span><br><span class="line">　　　　　　　　&apos;postcss-loader&apos;</span><br><span class="line">　　　　　　]</span><br><span class="line">　　　　&#125;]</span><br><span class="line">　　&#125;,</span><br><span class="line">　　plugins:[</span><br><span class="line">　　　　new MiniCssExtractPlugin(&#123;&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br><span class="line">module.exports = merge(commonConfig, prodConfig);</span><br></pre></td></tr></table></figure>

<p>然后对应到webpack.common.js里面删除css,scss相关到配置。运行npm run build。发现多出了两个文件main.css 和 main.css.map</p>
<p>css打包好后，是未压缩的，要将打包好的css进行压缩，安装，optimize-css-assets-webpack-plugin</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install optimize-css-assets-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>在webpack.props.js引入并配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const OptimizeCSSAssetsPlugin = require(&apos;optimize-css-assets-webpack-plugin&apos;);</span><br><span class="line">　　module.exports = &#123;</span><br><span class="line">　　　　optimization: &#123;</span><br><span class="line">　　　　　　minimizer: [new OptimizeCSSAssetsPlugin(&#123;&#125;)],</span><br><span class="line">　　　　&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行 npm run build。会发现css文件被自动的合并压缩。</p>
<p>还有更高级的用法， 假设有很多个css，要打包到一个css文件里面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://webpack.js.org/plugins/mini-css-extract-plugin</span><br></pre></td></tr></table></figure>

<p>也可以实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">　　splitChunks: &#123;</span><br><span class="line">　　　　cacheGroups: &#123;</span><br><span class="line">　　　　　　styles: &#123;</span><br><span class="line">　　　　　　　　name: &apos;styles&apos;,</span><br><span class="line">　　　　　　　　test: /\.css$/,</span><br><span class="line">　　　　　　　　chunks: &apos;all&apos;,</span><br><span class="line">　　　　　　　　enforce: true, // 忽略到前面到配置，不管是minSize,maxSize等等，只要是css，都打包到同一个文件中</span><br><span class="line">　　　　　　&#125;,</span><br><span class="line">　　　　&#125;,</span><br><span class="line">　　&#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/18webpack打包分析，preloading,prefetching的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/18webpack打包分析，preloading,prefetching的使用/" itemprop="url">webpack系列-18webpack打包分析，preloading,prefetching的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T15:58:30+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>打包分析：当我们使用webpack进行打包之后呢，我们可以借助webpack的一些打包工具进行一定的分析，然后看一下他打包是否合理。<br>webpack官网提供的一个分析工具的仓库：<a href="https://github.com/webpack/analyse。" target="_blank" rel="noopener">https://github.com/webpack/analyse。</a><br>如果要对我们自个打包生成的代码进行一个分析，首先要生成一个打包过程的描述文件，将–profile –json &gt; stats.json粘贴到package.json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"dev-build"</span>: <span class="string">"webpack --profile --json &gt; stats.json --config ./build/webpack.dev.js"</span>,</span><br><span class="line">　　<span class="string">"bundle"</span>: <span class="string">"webpack"</span>,</span><br><span class="line">　　<span class="string">"watch"</span>: <span class="string">"webpack --watch"</span>,</span><br><span class="line">　　<span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config ./build/webpack.dev.js"</span>,</span><br><span class="line">　　<span class="string">"build"</span>: <span class="string">"webpack --config ./build/webpack.prod.js"</span>,</span><br><span class="line">　　<span class="string">"server"</span>: <span class="string">"node server.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p> 他的意思是我把打包过程中的一些描述放置到stats.json的文件里面。这个文件的格式是一个json的格式。这么写完之后，我们进行一次打包。打包完之后在根目录出现一个叫做stats.json的文件。这个文件就是webpack自动生成的对应的我们webpack的描述文件。生成这个文件之后打开分析仓库，进入<a href="http://webpack.github.io/analyse/。把我们生成的stats.json传进去。会得到下面的这种结果" target="_blank" rel="noopener">http://webpack.github.io/analyse/。把我们生成的stats.json传进去。会得到下面的这种结果</a></p>
<p><img src="/images/18-1.png" alt></p>
<p> 告诉我们，整个打包用的是webpack 4.30.0的版本进行的打包。耗时，1.24s。打包对应的hash值是c631e7b50a03b44511b4。里面有4个模块。2个chunk，也就是2个文件，打包生成3个静态文件，打包过程没有警告，没有异常。上面的后面是每个的详细解析</p>
<p>除了这个工具之外，还有其他的分析工具，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://webpack.js.org/guides/code-splitting/<span class="comment">#bundle-analysis</span></span><br></pre></td></tr></table></figure>

<p>可以安装webpack-bundle-analyzer。我们做复杂项目的时候，代码分割跟我们的预期不相符，就可以通过这个做一些代码分析。看一看是不是有些代码重复打包了，是不是有哪些地方可以优化，哪一部分耗时比较长。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">　　splitChunks: &#123;</span><br><span class="line">　　　　chunks: <span class="string">'all'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们现在这个chunks是all，如果我们将此注释掉，默认的值是什么呢，是aysnc。也就是webpack默认只对异步代码进行分割。那么webpack为什么这么做呢。像jquery，lodash，这种库，应该对他进行分割。这样浏览器可以对他缓存，提高访问速度。但是我们只是提高第二次访问的速度。那真正的对页面做优化，webpack想达到的效果是，当你第一次访问页面的时候，他的加载速度就是最快的。要满足这种，靠将jquery,lodash打包成单独的文件是满足不了需求的。那么webpack真正希望我们编写代码的方式是什么样的呢？</p>
<p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// async <span class="keyword">function</span> <span class="function"><span class="title">getComponent</span></span>() &#123;</span><br><span class="line">// const &#123; default: _ &#125; = await import(/* webpackChunkName:<span class="string">"lodash"</span> */ <span class="string">'lodash'</span>);</span><br><span class="line">// var element = document.createElement(<span class="string">'div'</span>);</span><br><span class="line">// element.innerHTML = _.join([<span class="string">'1'</span>, <span class="string">' '</span>, <span class="string">'2'</span>], <span class="string">'-'</span>);</span><br><span class="line">// <span class="built_in">return</span> element;</span><br><span class="line">// &#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">// document.addEventListener(<span class="string">'click'</span>, ()=&gt; &#123;</span><br><span class="line">// getComponent().<span class="keyword">then</span>(element =&gt; &#123;</span><br><span class="line">// document.body.appendChild(element);</span><br><span class="line">// &#125;)</span><br><span class="line">// &#125;)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">document.addEventListener(<span class="string">'click'</span>, ()=&gt; &#123;</span><br><span class="line">　　var element = document.createElement(<span class="string">'div'</span>);</span><br><span class="line">　　element.innerHTML = <span class="string">'1-2'</span>;</span><br><span class="line">　　document.body.appendChild(element);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>下面的这个方式是我们以前标准的js写法。这段代码肯定没有问题。但是这个代码是否就完全没有优化的空间了，或者说这是不是webpack推荐的代码编写的方式。显然不是</p>
<p>打开控制台，快捷键 command+shift+p。 输入coverage，打开coverage，点击录制，刷新页面。可以看到main.js的利用率只有75.5%。那么为什么是75.5％呢，看到上面的main.js，一些红色，一些绿色，绿色的才有意义，红色的没用。click里面的代码，只有点击后才变绿。不然是红色，点击前是没有用的代码。一开始加载的时候，这里面的代码就不会执行，不会执行的代码，一开始就让页面下载下来，实际上就会浪费执行的性能</p>
<p>那么webpack希望这种交互的代码应该放到异步加载的模块里面去写，新建一个click.js<br>index.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">　　&lt;head&gt;</span><br><span class="line">　　　　&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">　　　　&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">　　　　&lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">　　　　&lt;title&gt;html template&lt;/title&gt;</span><br><span class="line">　　&lt;/head&gt;</span><br><span class="line">　　&lt;body&gt;</span><br><span class="line">　　　　&lt;div id=<span class="string">'root'</span>&gt;&lt;/div&gt;</span><br><span class="line">　　&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(<span class="string">'click'</span>, ()=&gt; &#123;</span><br><span class="line">　　import(<span class="string">'./click.js'</span>).<span class="keyword">then</span>((&#123;default: func&#125;) =&gt; &#123;</span><br><span class="line">　　　　func()</span><br><span class="line">　　&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>click.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">handleClick</span></span>()&#123;</span><br><span class="line">　　var element = document.createElement(<span class="string">'div'</span>);</span><br><span class="line">　　element.innerHTML = <span class="string">'1-2'</span>;</span><br><span class="line">　　document.body.appendChild(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> default handleClick;</span><br></pre></td></tr></table></figure>

<p>这个时候打包后运行index.html，发现main.js的利用率变成了78％，因为加载页面的时候并没有加载业务。所以webpack希望多写异步的代码，所以默认的chunks默认配置的是async。异步的。</p>
<p>比如用户未登录的情况下，首先我只加载首页的逻辑，不加载登录的逻辑，那么等我点击登录的时候再去记载登录，会不会很慢呢，那么preloading,prefetching就是解决这个问题的。在首页加载好之后，空闲的时间偷偷的去把登录的模块加载好。如果利用这个空闲的时间，两个条件都满足了。那么怎么做呢</p>
<p>将 /* webpackPrefetch: true */ 这句话放到引入的前面<br>index.js </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(<span class="string">'click'</span>, ()=&gt; &#123;</span><br><span class="line">　　import(/* webpackPrefetch: <span class="literal">true</span> */<span class="string">'./click.js'</span>).<span class="keyword">then</span>((&#123;default: func&#125;) =&gt; &#123;</span><br><span class="line">　　　　func()</span><br><span class="line">　　&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>意思是的当我点击的时候，去加载click.js，但不是非得点击的时候才去加载，而是主要的js加载好之后，有空闲的时候，会偷偷的去家在click.js。上面的这种魔法注释是prefetch的用法 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://webpack.js.org/guides/code-splitting<span class="comment">#prefetchingpreloading-modules</span></span><br></pre></td></tr></table></figure>

<p>preloading,prefetching的区别。prefetching会等主要的js加载完之后，空闲的时候再去加载click.js<br>/* webpackPreload: true */。preload是和主要的文件一起去加载的，所以preload还是不怎么合理的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">qicainiao</p>
              <p class="site-description motion-element" itemprop="description">Geek Spirit</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qicainiao</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
