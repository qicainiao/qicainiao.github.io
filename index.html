<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Geek Spirit">
<meta property="og:type" content="website">
<meta property="og:title" content="qicainiao&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="qicainiao&#39;s Blog">
<meta property="og:description" content="Geek Spirit">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="qicainiao&#39;s Blog">
<meta name="twitter:description" content="Geek Spirit">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>qicainiao's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">qicainiao's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Geek Spirit</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/04/js/new的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/04/js/new的实现/" itemprop="url">new的实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-04T17:39:01+08:00">
                2019-09-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="new的作用"><a href="#new的作用" class="headerlink" title="new的作用"></a>new的作用</h2><ul>
<li>返回实例对象</li>
<li>实例可以访问到构造函数的属性和方法 </li>
<li>实例可以访问到构造函数原型中的属性和方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//demo:</span><br><span class="line"></span><br><span class="line">function Person(name, age) &#123;</span><br><span class="line">this.name = name</span><br><span class="line">this.age = age</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayName = function () &#123;</span><br><span class="line">console.log(&quot;this.name:&quot;,this.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const man = new Person(&quot;张三&quot;,18)</span><br><span class="line">console.log(&quot;demo man:&quot;, man) //Person &#123; name: &apos;张三&apos;, age: 18 &#125;</span><br><span class="line">man.sayName() //this.name: 张三</span><br></pre></td></tr></table></figure>

<p>解析</p>
<p>思路:</p>
<p>创建一个新对象obj<br>把obj的<strong>proto</strong>指向Dog.prototype实现继承<br>执行构造函数,传递参数,改变this指向,Dog.call(obj, …args)<br>返回obj</p>
<h3 id="初步实现"><a href="#初步实现" class="headerlink" title="初步实现"></a>初步实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function myNew() &#123;</span><br><span class="line">const result = new Object() //最终返回的是个对象，所以先new一个出来</span><br><span class="line"></span><br><span class="line">const obj = Array.prototype.shift.call(arguments) //使用shift，截取第一个参数，即我们需要的构造函数</span><br><span class="line"></span><br><span class="line">//这一步其实可以不用，因为shift直接改变原数组，在后面的apply的时候直接传arguments即可</span><br><span class="line">const argArray = Array.prototype.slice.call(arguments)//将构造函数obj的this指向result对象，这样result就可以访问到obj中的属性或方法</span><br><span class="line"></span><br><span class="line">result.__proto__ = obj.prototype // 第二条,继承原型上的属性或方法</span><br><span class="line"></span><br><span class="line">obj.apply(result, argArray) //第一条,将构造函数obj的this指向result对象，这样result就可以访问到obj中的属性或方法</span><br><span class="line"></span><br><span class="line">return result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const b = myNew(Person, &quot;张三&quot;,19)</span><br><span class="line">console.log(&quot;test:&quot;, b) //test: &#123; name: &apos;张三&apos;, age: 19 &#125;</span><br></pre></td></tr></table></figure>

<p>完美实现，(^▽^) 哈哈哈。。。。</p>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p>如果构造函数有返回且返回的是个指定对象呢，比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Person(name, age) &#123;</span><br><span class="line">this.name = name</span><br><span class="line">this.age = age</span><br><span class="line">this.like = &quot;休息&quot;</span><br><span class="line">return &#123;</span><br><span class="line">like:this.like</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">const man = new Person(&quot;张三&quot;, 18)</span><br><span class="line">console.log(&quot;demo man:&quot;, man) //demo man: &#123; like: &apos;休息&apos; &#125;</span><br><span class="line">console.log(man.name, man.age) //undefined undefined</span><br></pre></td></tr></table></figure>

<p>代码实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function myNew() &#123;</span><br><span class="line"></span><br><span class="line">、、、、</span><br><span class="line">、、、、</span><br><span class="line"></span><br><span class="line">const  hasReturn = obj.apply(result,argArray)  //第一条,将构造函数obj的this指向result对象，这样result就可以访问到obj中的属性或方法</span><br><span class="line">                                             //同时看obj构造函数有无返回，且，返回是否为对象，否则，直接返回</span><br><span class="line">return typeof hasReturn === &apos;object&apos; ? hasReturn : result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const b = myNew(Person, &quot;张三&quot;, 19)</span><br><span class="line">console.log(&quot;test:&quot;, b) // test: &#123; like: &apos;休息&apos; &#125;</span><br><span class="line">console.log(b.name, b.age) // undefined undefined</span><br></pre></td></tr></table></figure>

<p>完成，(＾－＾)V</p>
<p>tips:如果构造函数没有返回或者返回的不是一个指定对象，比如只是 return “我是字符串” 这种，那返回不返回其实没啥区别<br> new还是返回的实例对象</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/js/函数式编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/js/函数式编程/" itemprop="url">函数式编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T14:23:17+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="函数组合"><a href="#函数组合" class="headerlink" title="函数组合"></a>函数组合</h2><p>最近后台接口返回的数据格式不对，数组总是以字符串的形式返回，前端统一转化<br>采用了函数式编程的方式解决</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var compose = function(f,g)&#123;</span><br><span class="line">    return function(x)&#123;</span><br><span class="line">       return f(g(x));</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var g = function(str)&#123;</span><br><span class="line">     console.log(str)</span><br><span class="line">   return str.replace(/^\[|\]$/g,&apos;&apos;);</span><br><span class="line">&#125;</span><br><span class="line">var f = function(str)&#123;</span><br><span class="line">    console.log(str)</span><br><span class="line">    return str.split(&apos;,&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var t = compose(f,g)</span><br><span class="line">console.log(t(&quot;[123,456]&quot;))</span><br></pre></td></tr></table></figure>

<h2 id="Pointfree"><a href="#Pointfree" class="headerlink" title="Pointfree"></a>Pointfree</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn = R.pipe(f1, f2, f3);</span><br></pre></td></tr></table></figure>

<p>这个公式说明，如果先定义f1、f2、f3，就可以算出fn。整个过程，根本不需要知道a或b。</p>
<p>也就是说，我们完全可以把数据处理的过程，定义成一种与参数无关的合成运算。不需要用到代表数据的那个参数，只要把一些简单的运算步骤合成在一起即可。</p>
<p>这就叫做 Pointfree：不使用所要处理的值，只合成运算过程。中文可以译作”无值”风格。</p>
<p>请看下面的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var addOne = x =&gt; x + 1;</span><br><span class="line">var square = x =&gt; x * x;</span><br><span class="line"></span><br><span class="line">var addOneThenSquare = R.pipe(addOne, square);</span><br><span class="line"></span><br><span class="line">addOneThenSquare(2) //  9</span><br></pre></td></tr></table></figure>

<p>addOneThenSquare是一个合成函数。定义它的时候，根本不需要提到要处理的值，这就是 Pointfree。</p>
<h2 id="JavaScript中的Pipe"><a href="#JavaScript中的Pipe" class="headerlink" title="JavaScript中的Pipe"></a>JavaScript中的Pipe</h2><p>  先用一个最简单的例子来看一下什么是pipe，现在我们有两个最简单的函数addOne和addTwo，分别对于参数加一和加二：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const addOne = x=&gt;x+1;</span><br><span class="line">const addTwo = x=&gt;x*2;</span><br><span class="line">const addThree = x=&gt;x-3;</span><br><span class="line">const addFour= x=&gt;x*4;</span><br></pre></td></tr></table></figure>

<p>  现在我们想让一个参数通过第一个参数之后再通过第二个参数，最简单直接方式<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addTwo(addOne(1)) //4</span><br></pre></td></tr></table></figure></p>
<p>  我们来写一个简单的pipe函数，它返回一个新的函数，来达到我们上面的目的：<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const pipe = (fun1,fun2) =&gt; x=&gt;fun2(fun1(x))</span><br><span class="line"></span><br><span class="line">const addTotal = pipe(addOne,addTwo);</span><br><span class="line">addTotal(1)</span><br></pre></td></tr></table></figure></p>
<p>  嗯，现在还看不出来什么好处，但是当我们要经过的Transform越来越多的时候，这样的好处就会越来越明显：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  const addTen = pipe(</span><br><span class="line">  addOne,</span><br><span class="line">  addTwo,</span><br><span class="line">  addThree,</span><br><span class="line">  addFour</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>  所以我们需要一个更牛逼的pipe函数，它可以接受任意数量的参数，并从第一个开始，依次接受原始数值，输出值传递给下一个函数。等等，我们好像想到了什么，遍历一个数组，把输出值当作下一个的输入，怎么听着都和reduce很像。所以，直接用Array.prototype.reduce就可以写一个简单的pipe函数：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> const pipe = (...args) =&gt; x =&gt; </span><br><span class="line">args.reduce(</span><br><span class="line">  (outputValue, currentFunction) =&gt; currentFunction(outputValue),</span><br><span class="line">  x</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>  展开</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> const pipe = function(x, ...fns) &#123;</span><br><span class="line">fns.reduce((outputValue, currentFunction) =&gt;  currentFunction(outputValue), x);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>  进一步拆解：<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> function pipe(x, ...fns)&#123;</span><br><span class="line">	let accu= x;</span><br><span class="line">	for(let f in fns)&#123;</span><br><span class="line">		accu= f(accu)</span><br><span class="line">	&#125;</span><br><span class="line">	return accu;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/js/数组/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/js/数组/" itemprop="url">Array 对象大全</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-03T10:49:48+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="数组属性"><a href="#数组属性" class="headerlink" title="数组属性"></a>数组属性</h2><p>属性               描述<br>constructor        返回创建数组对象的原型函数。<br>length          设置或返回数组元素的个数。<br>prototype        允许你向数组对象添加属性或方法。</p>
<h2 id="Array对象方法"><a href="#Array对象方法" class="headerlink" title="Array对象方法"></a>Array对象方法</h2><h4 id="splice-方法用于添加或删除数组中的元素。"><a href="#splice-方法用于添加或删除数组中的元素。" class="headerlink" title="splice() 方法用于添加或删除数组中的元素。"></a>splice() 方法用于添加或删除数组中的元素。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];</span><br><span class="line">fruits.splice(2,0,&quot;Lemon&quot;,&quot;Kiwi&quot;); </span><br><span class="line">//返回 []</span><br><span class="line">//fruits的值 Banana,Orange,Lemon,Kiwi,Apple,Mango</span><br><span class="line">fruits.splice(2,1) //删除一个，返回删除元素的数组</span><br><span class="line">fruits.splice(2,0) //删除0个，返回空数组</span><br><span class="line"></span><br><span class="line">var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];</span><br><span class="line">fruits.splice(2,2,&quot;Lemon&quot;,&quot;Kiwi&quot;);</span><br><span class="line">// 返回的删除元素的值 [&quot;Apple&quot;, &quot;Mango&quot;]</span><br><span class="line">//fruits的值[&quot;Banana&quot;, &quot;Orange&quot;, &quot;Lemon&quot;, &quot;Kiwi&quot;]</span><br></pre></td></tr></table></figure>

<p>语法<br>array.splice(index,howmany,item1,…..,itemX)<br>参数 Values<br>参数    描述<br>index    必需。规定从何处添加/删除元素。<br>该参数是开始插入和（或）删除的数组元素的下标，必须是数字。<br>howmany    可选。规定应该删除多少元素。必须是数字，但可以是 “0”。<br>如果未规定此参数，则删除从 index 开始到原数组结尾的所有元素。<br>item1, …, itemX    可选。要添加到数组的新元素</p>
<h4 id="slice-选取数组的的一部分，并返回一个新数组"><a href="#slice-选取数组的的一部分，并返回一个新数组" class="headerlink" title="slice()    选取数组的的一部分，并返回一个新数组"></a>slice()    选取数组的的一部分，并返回一个新数组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Lemon&quot;, &quot;Apple&quot;, &quot;Mango&quot;];</span><br><span class="line">var citrus = fruits.slice(1,3); //返回值 [&quot;Lemon&quot;, &quot;Apple&quot;]  fruits值不变</span><br></pre></td></tr></table></figure>

<h4 id="reduce-方法"><a href="#reduce-方法" class="headerlink" title="reduce() 方法"></a>reduce() 方法</h4><p>reduce() 可以作为一个高阶函数，用于函数的 compose。从左到右</p>
<h4 id="reduceRight-方法"><a href="#reduceRight-方法" class="headerlink" title="reduceRight() 方法"></a>reduceRight() 方法</h4><p>reduceRight() 可以作为一个高阶函数，用于函数的 compose。从右到左</p>
<h4 id="map-通过指定函数处理数组的每个元素，并返回处理后的数组。"><a href="#map-通过指定函数处理数组的每个元素，并返回处理后的数组。" class="headerlink" title="map()    通过指定函数处理数组的每个元素，并返回处理后的数组。"></a>map()    通过指定函数处理数组的每个元素，并返回处理后的数组。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let r = res.map(item =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        title: item.name,</span><br><span class="line">        sex: item.sex === 1? &apos;男&apos;:item.sex === 0?&apos;女&apos;:&apos;保密&apos;,</span><br><span class="line">        age: item.age,</span><br><span class="line">        avatar: item.img</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">也可以省略 return：</span><br><span class="line">const users=res.items.map(item =&gt; (&#123;</span><br><span class="line">    url: item.html_url,      </span><br><span class="line">    img: item.avatar_url,      </span><br><span class="line">    name: item.login,</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br><span class="line">//得到新数组，原数组不变化</span><br></pre></td></tr></table></figure>

<h4 id="some-检测数组元素中是否有元素符合指定条件。-结果是-true-or-false"><a href="#some-检测数组元素中是否有元素符合指定条件。-结果是-true-or-false" class="headerlink" title="some()    检测数组元素中是否有元素符合指定条件。 结果是 true or false"></a>some()    检测数组元素中是否有元素符合指定条件。 结果是 true or false</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var ages = [3, 10, 18, 20];</span><br><span class="line"></span><br><span class="line">function checkAdult(age) &#123;</span><br><span class="line">    return age &gt;= 18;</span><br><span class="line">&#125;</span><br><span class="line">ages.some(checkAdult); //true</span><br></pre></td></tr></table></figure>

<h4 id="shift-删除并返回数组的第一个元素。原数组第一个元素被删除"><a href="#shift-删除并返回数组的第一个元素。原数组第一个元素被删除" class="headerlink" title="shift()    删除并返回数组的第一个元素。原数组第一个元素被删除"></a>shift()    删除并返回数组的第一个元素。原数组第一个元素被删除</h4><h4 id="unshift-向数组的开头添加一个或更多元素，并返回新的长度。"><a href="#unshift-向数组的开头添加一个或更多元素，并返回新的长度。" class="headerlink" title="unshift()    向数组的开头添加一个或更多元素，并返回新的长度。"></a>unshift()    向数组的开头添加一个或更多元素，并返回新的长度。</h4><h4 id="push-方法"><a href="#push-方法" class="headerlink" title="push() 方法"></a>push() 方法</h4><h4 id="pop-方法-移除最后一个数组元素"><a href="#pop-方法-移除最后一个数组元素" class="headerlink" title="pop() 方法 移除最后一个数组元素"></a>pop() 方法 移除最后一个数组元素</h4><p>用于删除数组的最后一个元素并返回删除的元素。</p>
<h4 id="sort-方法-用于对数组的元素进行排序。"><a href="#sort-方法-用于对数组的元素进行排序。" class="headerlink" title="sort() 方法  用于对数组的元素进行排序。"></a>sort() 方法  用于对数组的元素进行排序。</h4><p>sort() 方法用于对数组的元素进行排序。</p>
<p>排序顺序可以是字母或数字，并按升序或降序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];</span><br><span class="line">fruits.sort();</span><br><span class="line">//返回值和fruits值都是[&quot;Apple&quot;, &quot;Banana&quot;, &quot;Mango&quot;, &quot;Orange&quot;]</span><br></pre></td></tr></table></figure>

<p>####forEach() 没有返回值，与for循环不能break，continue 。</p>
<h4 id="filter-方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。"><a href="#filter-方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。" class="headerlink" title="filter() 方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。"></a>filter() 方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var ages = [32, 33, 16, 40];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> checkAdult(age) &#123;</span><br><span class="line">    <span class="built_in">return</span> age &gt;= 18;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">myFunction</span></span>() &#123;</span><br><span class="line">    document.getElementById(<span class="string">"demo"</span>).innerHTML = ages.filter(checkAdult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义和用法</li>
</ul>
<p>filter() 方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。</p>
<p>注意： filter() 不会对空数组进行检测。</p>
<p>注意： filter() 不会改变原始数组。</p>
<h4 id="some-检测数组元素中是否有元素符合指定条件。"><a href="#some-检测数组元素中是否有元素符合指定条件。" class="headerlink" title="some()    检测数组元素中是否有元素符合指定条件。"></a>some()    检测数组元素中是否有元素符合指定条件。</h4><h4 id="from-方法"><a href="#from-方法" class="headerlink" title="from() 方法"></a>from() 方法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var myArr = Array.from(<span class="string">"RUNOOB"</span>); //[<span class="string">"R"</span>, <span class="string">"U"</span>, <span class="string">"N"</span>, <span class="string">"O"</span>, <span class="string">"O"</span>, <span class="string">"B"</span>]</span><br><span class="line"></span><br><span class="line">var setObj = new Set([<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>]);</span><br><span class="line">var objArr = Array.from(setObj);</span><br><span class="line">objArr[1] == <span class="string">"b"</span>;  // <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">var arr = Array.from([1, 2, 3], x =&gt; x * 10);  // [10, 20, 30]</span><br></pre></td></tr></table></figure>

<h4 id="indexOf-搜索数组中的元素，并返回它所在的位置。"><a href="#indexOf-搜索数组中的元素，并返回它所在的位置。" class="headerlink" title="indexOf()    搜索数组中的元素，并返回它所在的位置。"></a>indexOf()    搜索数组中的元素，并返回它所在的位置。</h4><h4 id="keys-返回数组的可迭代对象，包含原始数组的键-key-。"><a href="#keys-返回数组的可迭代对象，包含原始数组的键-key-。" class="headerlink" title="keys()    返回数组的可迭代对象，包含原始数组的键(key)。"></a>keys()    返回数组的可迭代对象，包含原始数组的键(key)。</h4><h4 id="includes-判断一个数组是否包含一个指定的值。"><a href="#includes-判断一个数组是否包含一个指定的值。" class="headerlink" title="includes()    判断一个数组是否包含一个指定的值。"></a>includes()    判断一个数组是否包含一个指定的值。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1,2].includes(1)</span><br><span class="line">true</span><br></pre></td></tr></table></figure>

<h4 id="find-方法返回通过测试（函数内判断）的数组的第一个元素的值。"><a href="#find-方法返回通过测试（函数内判断）的数组的第一个元素的值。" class="headerlink" title="find() 方法返回通过测试（函数内判断）的数组的第一个元素的值。"></a>find() 方法返回通过测试（函数内判断）的数组的第一个元素的值。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var ages = [3, 10, 18, 20];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> checkAdult(age) &#123;</span><br><span class="line">    <span class="built_in">return</span> age &gt;= 18;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">myFunction</span></span>() &#123;</span><br><span class="line">    document.getElementById(<span class="string">"demo"</span>).innerHTML = ages.find(checkAdult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义和用法</li>
</ul>
<p>find() 方法返回通过测试（函数内判断）的数组的第一个元素的值。</p>
<p>find() 方法为数组中的每个元素都调用一次函数执行：</p>
<p>当数组中的元素在测试条件时返回 true 时, find() 返回符合条件的元素，之后的值不会再调用执行函数。<br>如果没有符合条件的元素返回 undefined</p>
<h4 id="reverse-反转数组的元素顺序。"><a href="#reverse-反转数组的元素顺序。" class="headerlink" title="reverse()    反转数组的元素顺序。"></a>reverse()    反转数组的元素顺序。</h4><h4 id="findIndex-方法返回传入一个测试条件（函数）符合条件的数组第一个元素位置。"><a href="#findIndex-方法返回传入一个测试条件（函数）符合条件的数组第一个元素位置。" class="headerlink" title="findIndex() 方法返回传入一个测试条件（函数）符合条件的数组第一个元素位置。"></a>findIndex() 方法返回传入一个测试条件（函数）符合条件的数组第一个元素位置。</h4><h4 id="concat-连接两个或更多的数组，并返回结果"><a href="#concat-连接两个或更多的数组，并返回结果" class="headerlink" title="concat()  连接两个或更多的数组，并返回结果"></a>concat()  连接两个或更多的数组，并返回结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var hege = [<span class="string">"Cecilie"</span>, <span class="string">"Lone"</span>];</span><br><span class="line">var stale = [<span class="string">"Emil"</span>, <span class="string">"Tobias"</span>, <span class="string">"Linus"</span>];</span><br><span class="line">var kai = [<span class="string">"Robin"</span>];</span><br><span class="line">var children = hege.concat(stale,kai);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>使用<br> 一道面试题：传递两个参数m，n，返回长度为m，所有元素都为n的数组，要求不能用循环。</p>
<p> function fn(m,n){</p>
<pre><code>return m? fn(m-1,n).concat(n):[];</code></pre><p> }</p>
</li>
</ul>
<h4 id="copyWithin-从数组的指定位置拷贝元素到数组的另一个指定位置"><a href="#copyWithin-从数组的指定位置拷贝元素到数组的另一个指定位置" class="headerlink" title="copyWithin()  从数组的指定位置拷贝元素到数组的另一个指定位置"></a>copyWithin()  从数组的指定位置拷贝元素到数组的另一个指定位置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [<span class="string">"Banana"</span>, <span class="string">"Orange"</span>, <span class="string">"Apple"</span>, <span class="string">"Mango"</span>];</span><br><span class="line">fruits.copyWithin(2, 0);</span><br><span class="line">//Banana,Orange,Banana,Orange</span><br></pre></td></tr></table></figure>

<ul>
<li><p>语法</p>
<p> array.copyWithin(target, start, end)</p>
<ul>
<li>参数</li>
</ul>
<p>参数    描述<br>target    必需。复制到指定目标索引位置。<br>start    可选。元素复制的起始位置。<br>end    可选。停止复制的索引位置 (默认为 array.length)。如果为负值，表示倒数。</p>
</li>
</ul>
<h4 id="entries-方法返回一个数组的迭代对象，该对象包含数组的键值对-key-value-。"><a href="#entries-方法返回一个数组的迭代对象，该对象包含数组的键值对-key-value-。" class="headerlink" title="entries() 方法返回一个数组的迭代对象，该对象包含数组的键值对 (key/value)。"></a>entries() 方法返回一个数组的迭代对象，该对象包含数组的键值对 (key/value)。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [<span class="string">"Banana"</span>, <span class="string">"Orange"</span>, <span class="string">"Apple"</span>, <span class="string">"Mango"</span>];</span><br><span class="line">fruits.entries();</span><br><span class="line"></span><br><span class="line"><span class="comment"># [0, "Banana"]</span></span><br><span class="line"><span class="comment"># [1, "Orange"]</span></span><br><span class="line"><span class="comment"># [2, "Apple"]</span></span><br><span class="line"><span class="comment"># [3, "Mango"]</span></span><br></pre></td></tr></table></figure>

<h4 id="toString-把数组转换为字符串，并返回结果。"><a href="#toString-把数组转换为字符串，并返回结果。" class="headerlink" title="toString()    把数组转换为字符串，并返回结果。"></a>toString()    把数组转换为字符串，并返回结果。</h4><h4 id="every-检测数值元素的每个元素是否都符合条件。与some（）对应"><a href="#every-检测数值元素的每个元素是否都符合条件。与some（）对应" class="headerlink" title="every() 检测数值元素的每个元素是否都符合条件。与some（）对应"></a>every() 检测数值元素的每个元素是否都符合条件。与some（）对应</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var ages = [32, 33, 16, 40];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> checkAdult(age) &#123;</span><br><span class="line">    <span class="built_in">return</span> age &gt;= 18;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">myFunction</span></span>() &#123;</span><br><span class="line">    document.getElementById(<span class="string">"demo"</span>).innerHTML = ages.every(checkAdult);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>定义和用法</li>
</ul>
<p>every() 方法用于检测数组所有元素是否都符合指定条件（通过函数提供）。</p>
<p>every() 方法使用指定函数检测数组中的所有元素：</p>
<p>如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。<br>如果所有元素都满足条件，则返回 true。<br>注意： every() 不会对空数组进行检测。</p>
<p>注意： every() 不会改变原始数组。</p>
<h4 id="fill-方法用于将一个固定值替换数组的元素。"><a href="#fill-方法用于将一个固定值替换数组的元素。" class="headerlink" title="fill() 方法用于将一个固定值替换数组的元素。"></a>fill() 方法用于将一个固定值替换数组的元素。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [<span class="string">"Banana"</span>, <span class="string">"Orange"</span>, <span class="string">"Apple"</span>, <span class="string">"Mango"</span>];</span><br><span class="line">fruits.fill(<span class="string">"Runoob"</span>);</span><br><span class="line">//Runoob,Runoob,Runoob,Runoob</span><br></pre></td></tr></table></figure>

<ul>
<li>语法</li>
</ul>
<p>array.fill(value, start, end)</p>
<h4 id="keys-方法-用于从数组创建一个包含数组键的可迭代对象。"><a href="#keys-方法-用于从数组创建一个包含数组键的可迭代对象。" class="headerlink" title="keys() 方法 用于从数组创建一个包含数组键的可迭代对象。"></a>keys() 方法 用于从数组创建一个包含数组键的可迭代对象。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var fruits = [<span class="string">"Banana"</span>, <span class="string">"Orange"</span>, <span class="string">"Apple"</span>, <span class="string">"Mango"</span>];</span><br><span class="line">var x = fruits.keys();</span><br><span class="line"> x.next().value; //0</span><br><span class="line">  x.next().value;//1</span><br><span class="line">   x.next().value;//2</span><br></pre></td></tr></table></figure>

<h4 id="lastIndexOf-方法-返回一个指定的元素在数组中最后出现的位置，从该字符串的后面向前查找。"><a href="#lastIndexOf-方法-返回一个指定的元素在数组中最后出现的位置，从该字符串的后面向前查找。" class="headerlink" title="lastIndexOf() 方法 返回一个指定的元素在数组中最后出现的位置，从该字符串的后面向前查找。"></a>lastIndexOf() 方法 返回一个指定的元素在数组中最后出现的位置，从该字符串的后面向前查找。</h4><p>提示： 如果你想查找数组首次出现的位置，请使用 indexOf() 方法。</p>
<ul>
<li>语法<br>array.lastIndexOf(item,start)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//数组中的四个位置以前 查找字符串 &quot;Apple&quot;出现的位置</span><br><span class="line">var fruits=[&quot;Banana&quot;,&quot;Orange&quot;,&quot;Apple&quot;,&quot;Mango&quot;,&quot;Banana&quot;,&quot;Orange&quot;,&quot;Apple&quot;];</span><br><span class="line">var a = fruits.lastIndexOf(&quot;Apple&quot;,4);</span><br></pre></td></tr></table></figure>

<h4 id="valueOf-返回数组对象的原始值。"><a href="#valueOf-返回数组对象的原始值。" class="headerlink" title="valueOf()    返回数组对象的原始值。"></a>valueOf()    返回数组对象的原始值。</h4><p>该原始值由 Array 对象派生的所有对象继承。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/30/react性能优化/手把手测试react性能/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/30/react性能优化/手把手测试react性能/" itemprop="url">手把手测试react性能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-30T17:19:27+08:00">
                2019-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">react性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在最近的工作中我们发现开发一个已经持续开发了一年的React应用在IE11浏览器和一个老旧的安卓设备上工作不是特别流畅，这引起了我们的注意，决定抽出一些精力对代码做一些优化。虽然我们在日常开发中已经有意识的去写高质量、高效率的代码，但是由于开发人员的计算机性能都很好并且经常调试使用的chrome浏览器有一个强大的V8引擎所以性能问题还是经常会被忽略。</p>
<p>我是如何用React Profile发现问题，并分析解决问题的。</p>
<h2 id="分析工具"><a href="#分析工具" class="headerlink" title="分析工具"></a>分析工具</h2><p>性能问题通常是在手动测试或调试时直观感受到的，例如做某些操作时应用出现卡顿或是移动设备发热的情况。但是在这种情况下不太容找到问题到底出在哪些组件中，很多时候新添加的代码并不一定是问题的原因有可能只是个诱因。这时分析工具就非常有用了，可以帮助我们定位问题点。在这篇文章我用React+Redux的Todos例子作为演示代码。</p>
<h3 id="React-DevTools"><a href="#React-DevTools" class="headerlink" title="React DevTools"></a>React DevTools</h3><p>这应该是每个React开发者必备工具</p>
<h3 id="Highlight-Updates"><a href="#Highlight-Updates" class="headerlink" title="Highlight Updates"></a>Highlight Updates</h3><p>这是DevTools里提供的一个功能，在我们操作React App时可以高亮重新渲染的组件。</p>
<p>打开高亮功能</p>
<p><img src="/images/react/1.png" alt></p>
<p>使用<br>打开之后当操作App时重新渲染的组件会有一个高亮的边框，边框为蓝色时说明渲染时间短，黄色说明时间有点长，如果时间很长会是红色就要注意了。这个工具会给我们一个直观的显示哪些组件更新了。</p>
<p><img src="/images/react/2.gif" alt></p>
<h3 id="React-Profiler"><a href="#React-Profiler" class="headerlink" title="React Profiler"></a>React Profiler</h3><p>这个工具包含在React DevTools中，适用于react 16.5及之后版本。如果你的项目版本合适，会在DevTools里看到Profiler页。</p>
<p><img src="/images/react/3.png" alt></p>
<h2 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a>分析问题</h2><p>使用工具<br>点Profiler右上角的圆形按钮开始记录分析数据，然后在todos上添加3个新的todo项，完成操作之后再点圆形按钮结束录制。</p>
<p>从App上可以看到，每当添加新的todo项时，整个todo列表和每一个todo项都重新渲染了。 </p>
<p><img src="/images/react/4.gif" alt></p>
<p>然后看看Profiler中的数据。</p>
<p><img src="/images/react/5.png" alt></p>
<p>React渲染组件主要分两个阶段：渲染（Render）和提交（commit）。渲染阶段react执行组件中的render方法得到渲染结果也就是虚拟DOM，然后和上一次渲染的结果比较找出差异。提交阶段，react会添加、更新或删除真实DOM，把虚拟DOM中的内容渲染到页面中。</p>
<p><img src="/images/react/6.png" alt></p>
<p>右上角的1/3表示在录制过程中一共有3次提交，图中的每一个小条代表一次提交，黑色的是当前选中的提交，点击不同的条可以选择不同的提交。小条的高度和颜色反应了提交执行的时间，黄色高的条比蓝色条用的时间长。</p>
<p><img src="/images/react/7.png" alt></p>
<p>这部分是火焰图🔥，每一个小块对应一个组件，块的长度、颜色和组件渲染所用时间有关，黄色长的块说明消耗的时间更长。灰色说明这个组件在这次提交中没有重新渲染。这里显示的组件渲染时间是它自身渲染的时间和它所有子组件渲染时间的综合。</p>
<p><img src="/images/react/9.gif" alt></p>
<p>找到花费时间长的组件</p>
<p><img src="/images/react/10.png" alt></p>
<p>为了让问题更明显我加了30个todo到列表中，从图中很容易发现大部分时间都花在TodoList这个组件上。这个图里有一个容易产生困惑的地方就是Total Renders，这个数字代表的是这个组件在整个App生命周期里被渲染的次数，而不是在这次commit中被渲染的次数。</p>
<p>和之前只有3个todo时相比较，TodoList这个组件的渲染时间随着todo数量的增加而增加，因为每次渲染列表时每个todo都重新渲染了。而这些渲染并不是必要，因为每个新todo都是添加到列表末尾，之前的todo位置和内容都没有变化应该可以不再渲染。</p>
<p><img src="/images/react/11.gif" alt></p>
<p>点击第一个todo组件，然后切换不同的commit发现todo的props一直没有变化，这也证明了我们之前的想法是正确的。</p>
<h2 id="改进方法"><a href="#改进方法" class="headerlink" title="改进方法"></a>改进方法</h2><p>使用React.PureComponent或React.memo()避免不必要的组件重渲染<br>React.PureComponent和React.Component类似，但是React.PureComponent在shouldComponentUpdate()中对props和state做了一个浅比较，如果props和state没有变化则不渲染组件。</p>
<p>React.memo()是16.8版本加入的新功能，为使用函数定义的组件提供了类似PureComponent的功能。</p>
<p>本例中的Todo组件使用函数方式定义的，所以把最后一行使用React.memo()重写为 export default React.memo(Todo)</p>
<p>重写后的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;</span><br><span class="line">import PropTypes from &apos;prop-types&apos;</span><br><span class="line"></span><br><span class="line">const Todo = (&#123; onClick, completed, text &#125;) =&gt; (</span><br><span class="line">  &lt;li</span><br><span class="line">    onClick=&#123;onClick&#125;</span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">      textDecoration: completed ? &apos;line-through&apos; : &apos;none&apos;</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;text&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Todo.propTypes = &#123;</span><br><span class="line">  onClick: PropTypes.func.isRequired,</span><br><span class="line">  completed: PropTypes.bool.isRequired,</span><br><span class="line">  text: PropTypes.string.isRequired</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default React.memo(Todo);</span><br></pre></td></tr></table></figure>

<p>改过之后重新录制分析数据再来看看，</p>
<p><img src="/images/react/11.png" alt></p>
<p>嗯，并没有什么变化，再次看todo组件的分析数据。<br><img src="/images/react/12.gif" alt></p>
<p>通过比较两次commit，todo的props看上去没有变化，而且todo也没有state。不过进一步观察，props中completed, id, text都是原始类型，我们可以确定他们是没变的。onClick不同，这是一个函数，它是否变化同定义的方式有关。</p>
<p>通过查看代码，发现onClick是一个inline的箭头函数，问题是应该出在这里。</p>
<p>TodoList.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const TodoList = (&#123; todos, toggleTodo &#125;) =&gt; (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;todos.map(todo =&gt;</span><br><span class="line">      &lt;Todo</span><br><span class="line">        key=&#123;todo.id&#125;</span><br><span class="line">        &#123;...todo&#125;</span><br><span class="line">        onClick=&#123;() =&gt; toggleTodo(todo.id)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>不要使用inline定义的方法或Object为props传值<br>修改后的代码如下：</p>
<p>TodoList.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const TodoList = (&#123; todos, toggleTodo &#125;) =&gt; (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;todos.map(todo =&gt;</span><br><span class="line">      &lt;Todo</span><br><span class="line">        key=&#123;todo.id&#125;</span><br><span class="line">        &#123;...todo&#125;</span><br><span class="line">        onClick=&#123;toggleTodo&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>把原先的inline方法去掉，改为直接把toggleTodo传给Todo。</p>
<p>Todo.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const Todo = (&#123; onClick, id, completed, text &#125;) =&gt; &#123;</span><br><span class="line">  function clickHandler() &#123;</span><br><span class="line">    onClick(id)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;li</span><br><span class="line">      onClick=&#123;clickHandler&#125;</span><br><span class="line">      style=&#123;&#123;</span><br><span class="line">        textDecoration: completed ? &apos;line-through&apos; : &apos;none&apos;</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;text&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Todo.js中定义了一个clickHandler方法，这样todo方法每次重新运行时clickHandler都不会变。</p>
<p><img src="/images/react/13.png" alt></p>
<p>新的分析数据中可以看到前面的todo组件都是灰色说明没有重新渲染，只有最后一个新加的todo被渲染了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/30/react性能优化/react性能优化1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/30/react性能优化/react性能优化1/" itemprop="url">react性能优化一</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-30T17:05:59+08:00">
                2019-08-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react性能优化/" itemprop="url" rel="index">
                    <span itemprop="name">react性能优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="单个react组件性能优化"><a href="#单个react组件性能优化" class="headerlink" title="单个react组件性能优化"></a>单个react组件性能优化</h2><h3 id="render里面尽量减少新建变量和bind函数，传递参数是尽量减少传递参数的数量"><a href="#render里面尽量减少新建变量和bind函数，传递参数是尽量减少传递参数的数量" class="headerlink" title="render里面尽量减少新建变量和bind函数，传递参数是尽量减少传递参数的数量"></a>render里面尽量减少新建变量和bind函数，传递参数是尽量减少传递参数的数量</h3><p>首先我们先思考一个问题，比如我要实现一个点击按钮使相应的num增加1，我们有哪一些方法</p>
<p>大家应该都能想到，无非就是三种，如下图：</p>
<p>![]{/images/2-1.png}</p>
<p>第一种是在构造函数中绑定this，第二种是在render()函数里面绑定this，第三种就是使用箭头函数，都能实现上述方法；</p>
<p>但是哪一种方法的性能最好，是我们要考虑的问题。应该大家都知道答案：第一种的性能最好。</p>
<ul>
<li><p>因为第一种，构造函数每一次渲染的时候只会执行一遍；</p>
</li>
<li><p>第二种方法，在每次render()的时候都会重新执行一遍函数；</p>
</li>
<li><p>第三种方法的话，每一次render()的时候，都会生成一个新的箭头函数，即使两个箭头函数的内容是一样的。</p>
<p>第三种方法我们可以举一个例子，因为react判断是否需要进行render是浅层比较，简单来说就是通过===来判断的，如果state或者prop的类型是字符串或者数字，只要值相同，那么浅层比较就会认为其相同；</p>
<p>但是如果前者的类型是复杂的对象的时候，我们知道对象是引用类型，浅层比较只会认为这两个prop是不是同一个引用，如果不是，哪怕这两个对象中的内容完全一样，也会被认为是两个不同的prop。</p>
</li>
</ul>
<p>举个例子：</p>
<p>当我们给组件Foo给名为style的prop赋值；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Foo style=&#123;&#123; color:<span class="string">"red"</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>使用这种方法，每一次渲染都会被认为是一个style这个prop发生了变化，因为每一次都会产生一个对象给style。</p>
<p>那么我们应该如何改进，如果想要让react渲染的时候认为前后对象类型prop相同，则必须要保证prop指向同一个javascript对象，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const fooStyle = &#123; color: <span class="string">"red"</span> &#125;; //确保这个初始化只执行一次，不要放在render中，可以放在构造函数中</span><br><span class="line"></span><br><span class="line">&lt;Foo style=&#123;fooStyle&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>这个问题是我们在平时的编码中可以避免的。</p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<h2 id="props尽量只传需要的数据，避免多余的更新"><a href="#props尽量只传需要的数据，避免多余的更新" class="headerlink" title="props尽量只传需要的数据，避免多余的更新"></a>props尽量只传需要的数据，避免多余的更新</h2><h2 id="组件尽量解耦，比如一个input-list组建，可以将list分成一个PureComponent，只在list数据变化是更新"><a href="#组件尽量解耦，比如一个input-list组建，可以将list分成一个PureComponent，只在list数据变化是更新" class="headerlink" title="组件尽量解耦，比如一个input+list组建，可以将list分成一个PureComponent，只在list数据变化是更新"></a>组件尽量解耦，比如一个input+list组建，可以将list分成一个PureComponent，只在list数据变化是更新</h2><h2 id="如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index"><a href="#如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index" class="headerlink" title="如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index"></a>如果组件有复用，key值非常重要。因此key的优化，如果有唯一id，尽量不使用循环得到的index</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/29/hexo静态网站/Hexo+NexT 添加分类、标签、关于菜单项/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/29/hexo静态网站/Hexo+NexT 添加分类、标签、关于菜单项/" itemprop="url">hexo搭建静态网站-Hexo+NexT 添加分类、标签、关于菜单项</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-29T10:20:09+08:00">
                2019-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo搭建静态网站/" itemprop="url" rel="index">
                    <span itemprop="name">hexo搭建静态网站</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>极简风格博客 =windows + hexos + github<br>Hexo NexT主题下默认有首页和归档两个菜单，我们还可以开启其他菜单项，比如分类、标签、关于<br>这是这篇教程的成品图</p>
<p><img src="/images/hexo/2-1.png" alt></p>
<p>首先打开主题下的配置文件_config.yml，然后搜索menu找到如下配置项，将about、tags、categories前的#号去掉，就开启了关于、标签和分类标签，当然还有其他菜单项也可以开启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Menu Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash from link value (/archives -&gt; archives).</span></span><br><span class="line"><span class="comment"># Usage: `Key: /link/ || icon`</span></span><br><span class="line"><span class="comment"># Key is the name of menu item. If the translation for this item is available, the translated text will be loaded, otherwise the Key name will be used. Key is case-senstive.</span></span><br><span class="line"><span class="comment"># Value before `||` delimiter is the target link.</span></span><br><span class="line"><span class="comment"># Value after `||` delimiter is the name of FontAwesome icon. If icon (with or without delimiter) is not specified, question icon will be loaded.</span></span><br><span class="line"><span class="comment"># External url should start with http:// or https://</span></span><br><span class="line">menu:</span><br><span class="line">  home: / || home</span><br><span class="line">  about: /about/ || user</span><br><span class="line">  tags: /tags/ || tags</span><br><span class="line">  categories: /categories/ || th</span><br><span class="line">  archives: /archives/ || archive</span><br><span class="line">  <span class="comment">#schedule: /schedule/ || calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || sitemap</span></span><br></pre></td></tr></table></figure>

<p>重新生成部署后，可以看到新增的菜单项，但是单击后会报如下错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cannot GET /about/</span><br><span class="line">Cannot GET /tags/</span><br><span class="line">Cannot GET /categories/</span><br></pre></td></tr></table></figure>

<p>这是因为你还需运行如下命令新建相关页面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new page <span class="string">"about"</span></span><br><span class="line">hexo new page <span class="string">"tags"</span></span><br><span class="line">hexo new page <span class="string">"categories"</span></span><br></pre></td></tr></table></figure>

<p>运行结果如下，会再source文件下创建about、tags、categories文件夹，每个文件夹下还会创建一个index.md文件表示关于、标签页分类页面，编辑这三个MarkDown文件可以自定义这三个页面的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D:\hexo\blog&gt;hexo new page <span class="string">"about"</span></span><br><span class="line">INFO  Created: D:\hexo\blog\<span class="built_in">source</span>\about\index.md</span><br><span class="line"> </span><br><span class="line">D:\hexo\blog&gt;hexo new page <span class="string">"tags"</span></span><br><span class="line">INFO  Created: D:\hexo\blog\<span class="built_in">source</span>\tags\index.md</span><br><span class="line"> </span><br><span class="line">D:\hexo\blog&gt;hexo new page <span class="string">"categories"</span></span><br><span class="line">INFO  Created: D:\hexo\blog\<span class="built_in">source</span>\categories\index.md</span><br></pre></td></tr></table></figure>

<p>还差最后一步，打开各页面对应的index.md文件，编辑如下内容，title和date是默认生成的，增加type即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2019-08-29 09:50:23</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"about"</span></span><br><span class="line">---</span><br><span class="line"> </span><br><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2019-08-29 09:50:23</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"tags"</span></span><br><span class="line">---</span><br><span class="line"> </span><br><span class="line">---</span><br><span class="line">title: about</span><br><span class="line">date: 2019-08-29 09:50:23</span><br><span class="line"><span class="built_in">type</span>: <span class="string">"categories"</span></span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>重新生成和部署即可看到效果</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/29/hexo静态网站/搭建github博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/29/hexo静态网站/搭建github博客/" itemprop="url">hexo搭建静态网站-搭建github博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-29T10:15:31+08:00">
                2019-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo搭建静态网站/" itemprop="url" rel="index">
                    <span itemprop="name">hexo搭建静态网站</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>极简风格博客 =windows + hexos + github<br>这是这篇教程的成品图</p>
<p><img src="/images/hexo/1-1.png" alt></p>
<p>#博客搭建分为三步：#</p>
<ul>
<li>创建github域名及空间</li>
<li>git，nodejs，hexo下载及安装</li>
<li>配置环境</li>
</ul>
<p>##1.创建github域名及空间<br>进入github官网，注册并登录。<br>登录后，点击右上角的 “+” 号，选择 “new repository” , 会出现以下界面：</p>
<p><img src="/images/hexo/1-2.png" alt></p>
<p>在 repository name 中填入 username.github.io 。（username指的是前面owner的用户名，比如我这里应该填 wenjie710.github.io 。）<br>然后点击最下面的create repository 即可。<br>2.安装 git，nodejs，hexo<br>下载地址：<br>git官网下载：<a href="https://git-scm.com/download/win" target="_blank" rel="noopener">https://git-scm.com/download/win</a><br>nodejs官网下载：<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a><br>以上两个工具都是直接下载的exe文件，点击安装即可。安装完成之后在文件夹中点击鼠标右键会看到下拉菜单中有一个 Git Bash ，这是一个类似于Liunx的终端，在里面可以模拟Linux下的终端进行操作。<br>git 和 nodejs 安装完成之后才能安装hexo。hexo的安装十分简单，只需要在命令提示符（cmd）中输入以下命令即可。</p>
<pre><code>npm install -g hexo-cli</code></pre><p>3.配置环境<br>3.1 配置ssh<br>打开 Git Bash ，执行下面的命令生成 SSH 访问私钥及公钥。</p>
<pre><code>ssh-keygen -t rsa -C &quot;email@email.com&quot;</code></pre><p>输入命令回车之后会提示你输入一些东西，不用管。一直回车到底就好了。然后你的 ~/.ssh 文件下就会生成两个文件 id_rsa 和 id_rsa.pub 。</p>
<p><img src="/images/hexo/1-3.png" alt></p>
<p>打开你的 Github -&gt; setting -&gt; SSH Keys 。然后点击 New SSH Key 创建一个新的SSH Key。将文件 id_rsa.pub 中的所以内容复制粘贴到 Key 下面。然后使用下面的命令测试是否可以连接上 Github.</p>
<pre><code>ssh -T git@github.com</code></pre><p>3.2 编写配置，发布博客<br>3.2.1 主题安装<br>新建一个用以存储博客的文件夹</p>
<pre><code>hexo init username@github.io</code></pre><p>安装主题，推荐 next， 其它也行，可以自己选选。</p>
<pre><code>cd username@github.io
git clone https://github.com/iissnan/hexo-theme-next themes/next</code></pre><p>3.2.2 自定义配置文件<br>打开 username.github.io/_config.yml ，修改以下键值对(注意冒号之后一定要有空格）：</p>
<pre><code>title: GA-17&apos;s Blog
subtitle:
description: Hello World!
author: GA-17
language: zh-Hans
theme: next
deploy:
  type: git
  repo: https://github.com/wenjie710/wenjie710.github.io.git
  branch: master</code></pre><p>3.2.3 配置完成，写文章！！！<br>在username.github.io/source/_posts下创建你的第一个博客吧，例如，创建一个名为FirstBlog.md的文件，格式用Markdown，注意保存。</p>
<pre><code>---
title: My First Blog
---</code></pre><p>咱的博客搭建完成啦！！</p>
<p>3.2.4 发布<br>安装hexo-deployer-git自动部署发布工具</p>
<pre><code>npm install hexo-deployer-git --save</code></pre><p>发布博客</p>
<pre><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d

# hexo clean 清除缓存
# hexo g 生成静态页面
# hexo s 启动服务预览
# hexo d 开始部署</code></pre><p>如果这是第一次登录，终端会让你输入Github 的邮箱和密码，正确输入后，就会把你的博客上传至Github 了。以后在每次把博客写完后，执行一下这个命令即可。<br>至此，博客搭建完成。进入<a href="https://username.github.io" target="_blank" rel="noopener">https://username.github.io</a> 就能看见自己的博客啦！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/webpack性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/webpack性能优化/" itemprop="url">webpack系列-webpack性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T18:41:57+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们在打包的时候需要耗费非常多的时间，所以在一些大型项目的时候需要提升webpack的打包效率。</p>
<h2 id="打点"><a href="#打点" class="headerlink" title="打点"></a>打点</h2><p>   使用speed-measure-webpack-plugin测试</p>
<h2 id="跟上技术的迭代（node-npm-yarn）"><a href="#跟上技术的迭代（node-npm-yarn）" class="headerlink" title="跟上技术的迭代（node,npm,yarn）"></a>跟上技术的迭代（node,npm,yarn）</h2><p>　升级webpack，node，npm，yarn的版本。新的版本会做优化</p>
<h2 id="在尽可能少的模块上应用Loader"><a href="#在尽可能少的模块上应用Loader" class="headerlink" title="在尽可能少的模块上应用Loader"></a>在尽可能少的模块上应用Loader</h2><p>比如曾经有个功能将this指向window的功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rules:[&#123;</span><br><span class="line">　　use:[&#123;</span><br><span class="line">　　　　loader: <span class="string">'imports-loader?this=&gt;window'</span></span><br><span class="line">　　&#125;]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>这个时候可以把他干掉，作用不大。<br>比如js打包一定要加exclude:/node_modules/</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rules:[&#123;</span><br><span class="line">　　<span class="built_in">test</span>:/\.js$/,</span><br><span class="line">　　exclude:/node_modules/</span><br><span class="line">　　use:[[</span><br><span class="line">　　　　loader:<span class="string">'babel-loader'</span></span><br><span class="line">　　]]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>node_modules的第三方模块都是编译过，不需要二次打包，合理使用exclude,include</p>
<h2 id="尽可能少的使用plugin，同时确保plugin的可靠性。"><a href="#尽可能少的使用plugin，同时确保plugin的可靠性。" class="headerlink" title="尽可能少的使用plugin，同时确保plugin的可靠性。"></a>尽可能少的使用plugin，同时确保plugin的可靠性。</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const MiniCssExtractPlugin = require(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins:[</span><br><span class="line">　　　　new MiniCssExtractPlugin(&#123;&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>比如上线的时候使用OptimizeCSSAssetsPlugin，压缩css的插件。希望在打包生成代码的时候，如果我引入了css文件，那么把css文件打包到dist目录下。而不是直接引入到js文件里面。如果是开发环境，就不需要使用这个插件，不对代码进行压缩，就节约了代码打包压缩的时间。所以插件尽量使用官方的插件，官方的插件是经过官网测试的，在自己引用第三方插件的时候，也需要是社区里经过测试的。可以有效提升webpack打包速度。</p>
<h2 id="resolve参数合理配置"><a href="#resolve参数合理配置" class="headerlink" title="resolve参数合理配置"></a>resolve参数合理配置</h2><p>比如我们之前引入一个js文件的时候，是这样的，import Child from ‘../child/child’。<br>后面没有加js后缀也可以引入。在一开始的时候是不支持这样引入的。可以引入是因为webpack下有这么一段代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　extensions: [<span class="string">'./js'</span>, <span class="string">'.jsx'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当看到resolve可以这么配，就想好多东西都配置在这里</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　extensions: [<span class="string">'./css'</span>, <span class="string">'./jpg'</span>, <span class="string">'./js'</span>, <span class="string">'.jsx'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就意味着很多次查找，每次查找的时候一般会损耗性能的。一般js,jsx的时候配置resolve，其他手动写后缀去引入。</p>
<p>resolve还有其他的用法，比如src/child/child这样引入。import Child from ‘./child/‘这样也可以引入child.js文件，本身这样引入是不行的，如果把child.js改成index.js也可以，但是现在是child.js，不是index.js怎么弄</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　extensions: [<span class="string">'./js'</span>, <span class="string">'.jsx'</span>],</span><br><span class="line">　　mainFiles: [<span class="string">'index'</span>, <span class="string">'child'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>他的意思是引入某个目录下不知道什么文件的时候，首先会先尝试去找index文件，如果index文件不存在再去找child文件。这样额外配置resolve里面的内容也会有影响，一般我们不这样配。</p>
<p>resolve还有其他的配置项。比如alias，当文件比较深的时候可以引入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">　　<span class="built_in">alias</span>: &#123;</span><br><span class="line">　　　　child: path.resolve(__dirname, <span class="string">'../src/a/b/c'</span>)</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在文件中直接 import Child from ‘child/xxx.js’就可以了。</p>
<h2 id="使用DllPlugin提高打包速度"><a href="#使用DllPlugin提高打包速度" class="headerlink" title="使用DllPlugin提高打包速度"></a>使用DllPlugin提高打包速度</h2><p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from <span class="string">'react'</span>;</span><br><span class="line">import &#123; BrowserRouter, Route &#125; from <span class="string">'react-router-dom'</span>;</span><br><span class="line">import ReactDom from <span class="string">'react-dom'</span>;</span><br><span class="line">import _ from <span class="string">'lodash'</span>;</span><br><span class="line"></span><br><span class="line">class App extends Component&#123;</span><br><span class="line">　　<span class="function"><span class="title">render</span></span>() &#123;</span><br><span class="line">　　　　<span class="built_in">return</span> (</span><br><span class="line">　　　　　　&lt;BrowserRouter&gt;</span><br><span class="line">　　　　　　　　&lt;div&gt;</span><br><span class="line">　　　　　　　　　　&#123;_.join([<span class="string">'this'</span>,<span class="string">'is'</span>,<span class="string">'app'</span>], <span class="string">' '</span>)&#125;</span><br><span class="line">　　　　　　　　&lt;/div&gt;</span><br><span class="line">　　　　　　&lt;/BrowserRouter&gt;</span><br><span class="line">　　　　)</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDom.render(&lt;App/&gt;, document.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure>

<p>像lodash这样的第三方模块加进去后，大概打包多了一百多ms。像这种代码不会变多第三方模块，我们不必每次都去打包分析，第二次直接用第一次分析好多结果就好了。首先建立一个webpack.dll.js</p>
<p>webpack.dll.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry:&#123;</span><br><span class="line">　　　　vendors: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>, <span class="string">'lodash'</span>]</span><br><span class="line">　　&#125;,</span><br><span class="line">　　output:&#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].dll.js'</span>,</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'../dll'</span>),</span><br><span class="line">　　　　// 通过一个全局变量暴露出去，全局变量叫做vendors</span><br><span class="line">　　　　library: <span class="string">'[name]'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后配置文件增加一个</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"build:dll"</span>: <span class="string">"webpack --config ./build/webpack.dll.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后我们打包好了一个叫做vendors.dll.js的文件。怎么引用，我们把vendors.dll.js植入到index.html里面，就可以全局引入vendors这个变量</p>
<p>安装一个插件，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install add-asset-html-webpack-plugin --save</span><br></pre></td></tr></table></figure>

<p>顾名思义就是在html里面去增加一些静态的资源.安装好后，配置webpack.common.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const AddAssetHtmlWebpackPlugin = require(<span class="string">'add-asset-html-webpack-plugin'</span>);</span><br><span class="line">plugins: [</span><br><span class="line">　　// filepath表示要增加到文件是哪些</span><br><span class="line">　　new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　filepath: path.resolve(__dirname, <span class="string">'../dll/vendors.dll.js'</span>)</span><br><span class="line">　　&#125;)</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>然后运行npm run dev (“webpack-dev-server –config ./build/webpack.common.js”)。打开控制台，可以看到已经引入了vendors.dll.js。也有了vendors这个全局变量。</p>
<p>到了这一步，离目标近了一步。我们到目标是第三方模块只打包一次。现在我们打包好了第三方模块，可以被使用。但还没有被使用的这一步。接下来我们看怎么使用第三方模块。<br>webpack.dll.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　// 用这个插件分析这个库，把库里面一些第三方模块的映射关系放到了dll下面的vendors.mainfest.json</span><br><span class="line">　　　　new webpack.DllPlugin(&#123;</span><br><span class="line">　　　　　　name: <span class="string">'[name]'</span>,</span><br><span class="line">　　　　　　path: path.resolve(__dirname, <span class="string">'../dll/[name].manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack.common.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　/**</span><br><span class="line">　　　　* 使用这个插件，当打包index.js的时候，会引入一些第三方模块，当发现第三方模块的时候，会去manifest去找映射关系</span><br><span class="line">　　　　* 找到就不用再重新分析打包了，去vendors这个全局变量找就好了</span><br><span class="line">　　　　* 不在第三方模块，才会去分析</span><br><span class="line">　　　　*/</span><br><span class="line">　　　　new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll/vendors.manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后重新打包，看到之前时间是1500ms左右，现在是1100ms左右。 我们也可以对打包的webpack.dll.js进行拆分</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry:&#123;</span><br><span class="line">　　　　vendors: [<span class="string">'lodash'</span>],</span><br><span class="line">　　　　react: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>]</span><br><span class="line">　　&#125;,</span><br><span class="line">　　output:&#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].dll.js'</span>,</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'../dll'</span>),</span><br><span class="line">　　　　// 通过一个全局变量暴露出去，全局变量叫做vendors</span><br><span class="line">　　　　library: <span class="string">'[name]'</span></span><br><span class="line">　　&#125;,</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　// 用这个插件分析这个库，把库里面一些第三方模块的映射关系放到了dll下面的vendors.mainfest.json</span><br><span class="line">　　　　new webpack.DllPlugin(&#123;</span><br><span class="line">　　　　　　name: <span class="string">'[name]'</span>,</span><br><span class="line">　　　　　　path: path.resolve(__dirname, <span class="string">'../dll/[name].manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再执行npm run build:dll（”build:dll”: “webpack –config ./build/webpack.dll.js”）。生成了vendors.dll.js和react.dll.js两个文件。同时webpack.commmon.js也要增加新增的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　　　filepath: path.resolve(__dirname, <span class="string">'../dll/vendors.dll.js'</span>)</span><br><span class="line">　　　　&#125;),</span><br><span class="line">　　　　new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　　　filepath: path.resolve(__dirname, <span class="string">'../dll/react.dll.js'</span>)</span><br><span class="line">　　　　&#125;),</span><br><span class="line">　　　　new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll/vendors.manifest.json'</span>)</span><br><span class="line">　　　　&#125;),</span><br><span class="line">　　　　new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll/react.manifest.json'</span>)</span><br><span class="line">　　　　&#125;)</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那如果在大型项目中，dll文件就会非常的多，在plugins里面也要不断的加dll.js和mainfest.json。我们这样做个优化</p>
<p>把基础的plugins提取出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const plugins = [</span><br><span class="line">　　// HtmlWebpackPlugin会在打包结束后，自动生成一个html文件，并把打包生成的js自动引入到这个html文件中</span><br><span class="line">　　new HtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　template: <span class="string">'src/index.html'</span></span><br><span class="line">　　&#125;),</span><br><span class="line">　　new CleanWebpackPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>接着通过node分析dll下有几个dll文件，有几个mainfest.json文件。然后动态的往plugins里面添加这个AddAssetHtmlWebpackPlugin和DllReferencePlugin。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 引入node fs</span><br><span class="line">const fs = require(<span class="string">'fs'</span>);</span><br><span class="line">// 读取dll文件的所有文件名</span><br><span class="line">const files = fs.readdirSync(path.resolve(__dirname, <span class="string">'../dll'</span>));</span><br><span class="line">const plugins = [</span><br><span class="line">　　// HtmlWebpackPlugin会在打包结束后，自动生成一个html文件，并把打包生成的js自动引入到这个html文件中</span><br><span class="line">　　new HtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　template: <span class="string">'src/index.html'</span></span><br><span class="line">　　&#125;),</span><br><span class="line">　　new CleanWebpackPlugin()</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">// 读取dll文件的所有内容</span><br><span class="line">const files = fs.readdirSync(path.resolve(__dirname, <span class="string">'../dll'</span>));</span><br><span class="line"></span><br><span class="line">files.forEach(file =&gt;&#123;</span><br><span class="line">　　// // filepath表示要增加到文件是哪些</span><br><span class="line">　　<span class="keyword">if</span>(/.*\.dll.js/.<span class="built_in">test</span>(file)) &#123;</span><br><span class="line">　　　　plugins.push(new AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">　　　　　　filepath: path.resolve(__dirname, <span class="string">'../dll'</span>, file)</span><br><span class="line">　　　　&#125;))</span><br><span class="line">　　&#125;</span><br><span class="line">　　// /**</span><br><span class="line">　　// * 使用这个插件，当打包index.js的时候，会引入一些第三方模块，当发现第三方模块的时候，会去mainfest去找映射关系</span><br><span class="line">　　// * 找到就不用再重新分析打包了，去vendors这个全局变量找就好了</span><br><span class="line">　　// * 不在第三方模块，才会去分析</span><br><span class="line">　　// */</span><br><span class="line">　　<span class="keyword">if</span>(/.*\.manifest.json/.<span class="built_in">test</span>(file))&#123;</span><br><span class="line">　　　　plugins.push(new webpack.DllReferencePlugin(&#123;</span><br><span class="line">　　　　　　manifest: path.resolve(__dirname, <span class="string">'../dll'</span>, file)</span><br><span class="line">　　　　&#125;))</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="控制包文件大小-tree-shaking-splitChunks"><a href="#控制包文件大小-tree-shaking-splitChunks" class="headerlink" title="控制包文件大小(tree shaking, splitChunks)"></a>控制包文件大小(tree shaking, splitChunks)</h2><h2 id="thread-loader-parallel-webpack-happypack多进程打包"><a href="#thread-loader-parallel-webpack-happypack多进程打包" class="headerlink" title="thread-loader,parallel-webpack,happypack多进程打包"></a>thread-loader,parallel-webpack,happypack多进程打包</h2><h2 id="合理使用sourceMap，soureMap越详细，打包速度越慢"><a href="#合理使用sourceMap，soureMap越详细，打包速度越慢" class="headerlink" title="合理使用sourceMap，soureMap越详细，打包速度越慢"></a>合理使用sourceMap，soureMap越详细，打包速度越慢</h2><h2 id="结合stats，打包分析工具分析打包结果"><a href="#结合stats，打包分析工具分析打包结果" class="headerlink" title="结合stats，打包分析工具分析打包结果"></a>结合stats，打包分析工具分析打包结果</h2><h2 id="开发环境内存编译-devServer，内存的读取比硬盘读取快"><a href="#开发环境内存编译-devServer，内存的读取比硬盘读取快" class="headerlink" title="开发环境内存编译(devServer，内存的读取比硬盘读取快)"></a>开发环境内存编译(devServer，内存的读取比硬盘读取快)</h2><h2 id="开发环境无用插件剔除（比如开发环境，mode不要用production）"><a href="#开发环境无用插件剔除（比如开发环境，mode不要用production）" class="headerlink" title="开发环境无用插件剔除（比如开发环境，mode不要用production）"></a>开发环境无用插件剔除（比如开发环境，mode不要用production）</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/22webpack中第三方库library的打包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/22webpack中第三方库library的打包/" itemprop="url">webpack系列-22webpack中第三方库library的打包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T18:33:41+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前都是对自己写的业务代码进行打包，但假设我们要开发一个库，这样的库代码如何用webpack进行打包呢，首先我们创建一个非常简单的函数库</p>
<p>首先新建一个文件夹library，运行npm init -y，得到一个package.json<br>package.json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">　　<span class="string">"name"</span>: <span class="string">"library"</span>,</span><br><span class="line">　　<span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">　　<span class="string">"description"</span>: <span class="string">""</span>,</span><br><span class="line">　　<span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">　　<span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　&#125;,</span><br><span class="line">　　<span class="string">"keywords"</span>: [],</span><br><span class="line">　　<span class="string">"author"</span>: <span class="string">""</span>,</span><br><span class="line">　　<span class="string">"license"</span>: <span class="string">"MIT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后library下新建一个src,里面建三个文件,math.js,string.js,index.js</p>
<p>math.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> add(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> minus(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> cheng(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> chu(a,b) &#123;</span><br><span class="line">　　<span class="built_in">return</span> a / b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>string.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> join(a, b)&#123;</span><br><span class="line">　　<span class="built_in">return</span> a + <span class="string">''</span> + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import * as math from <span class="string">'./math'</span>;</span><br><span class="line">import * as string from <span class="string">'./string'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> default &#123; math, string &#125;</span><br></pre></td></tr></table></figure>

<p>然后安装webpack</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli --save</span><br></pre></td></tr></table></figure>

<p>新建配置文件 webpack.config.js<br>webpack.config.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>package.json里面配置script</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后运行 npm run build。生成一个dist文件夹，里面生成了一个library.js。如果是我们业务代码，就好了。但是我们生成的是一个库，给别人用的，那么别人怎么用呢</p>
<p>第一种</p>
<p>import library from ‘library’;<br>第二种<br>const library = require(‘library’);<br>第三种</p>
<p>require([‘library’],function() {<br>})<br>如果我们的库想外面可以被这样引用。可以做一个配置,webpack.config.js里面output多加一个参数<br>webpack.config.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span>,</span><br><span class="line">　　　　// 通过任何形式，都可以引用的到</span><br><span class="line">　　　　libraryTarget: <span class="string">'umd'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了这种引用之外，我还希望别人通过引用srcipt后，可以通过全局变量来使用这个库</p>
<script src="library.js"></script>
<p>library.add();<br>再配置一下webpack.config.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span>,</span><br><span class="line">　　　　// 打包生成的代码挂载到页面到一个全局变量上</span><br><span class="line">　　　　library: <span class="string">'library'</span>,</span><br><span class="line">　　　　// 通过任何形式，都可以引用的到</span><br><span class="line">　　　　libraryTarget: <span class="string">'umd'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们做一个测试，在生成好的dist目录下新建index.html</p>
<p>index.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">　　&lt;head&gt;</span><br><span class="line">　　　　&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">　　　　&lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">　　　　&lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">　　　　&lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">　　　　&lt;script src=<span class="string">"./library.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">　　&lt;/head&gt;</span><br><span class="line">　　&lt;body&gt;</span><br><span class="line">　　&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>然后运行这个页面，控制台调用library;</p>
<p>除了在打包库的时候，我们要额外的配置这两个参数之外呢，我们还要做一件事情。比如string.js<br>string.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> join(a, b)&#123;</span><br><span class="line">　　<span class="built_in">return</span> a + <span class="string">''</span> + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在写的时候发现lodash里面有个功能很好</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install lodash --save</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import _ from <span class="string">'lodash'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> join(a, b)&#123;</span><br><span class="line">　　<span class="built_in">return</span> _.join([a,b], <span class="string">' '</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后现在看起来没有问题，但是别人使用我们的库的时候，他也有可能重新使用了lodash。这就导致一个问题，我们的库里面打包了一次lodash，用户的业务代码里面又打包了一次lodash。所以用户的业务代码里面就容易存在两份lodash代码。为了解决这个问题，我们需要在库里面做一个另外的配置，externals</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">　　mode: <span class="string">'production'</span>,</span><br><span class="line">　　entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">　　// 如果打包过程中遇到lodash，就忽略这个库，不要打包到代码里面去</span><br><span class="line">　　externals: [<span class="string">'lodash'</span>],</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">　　　　filename: <span class="string">'library.js'</span>,</span><br><span class="line">　　　　// 打包生成的代码挂载到页面到一个全局变量上</span><br><span class="line">　　　　library: <span class="string">'library'</span>,</span><br><span class="line">　　　　// 通过任何形式，都可以引用的到</span><br><span class="line">　　　　libraryTarget: <span class="string">'umd'</span></span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候外面直接使用library就不可以了，因为库里面要用lodash。所以在用这个库的时候，业务代码里面要另外引入lodash。</p>
<p>现在我们看下externals的作用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">externals : &#123;</span><br><span class="line">　　lodash : &#123;</span><br><span class="line">　　　　commonjs: <span class="string">'lodash'</span>,</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这个意思是。如果lodash这个库在commonjs环境下被使用，lodash加载的时候，名字必须是lodash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const lodash = require(<span class="string">'lodash'</span>);</span><br><span class="line"></span><br><span class="line">externals : &#123;</span><br><span class="line">　　lodash : &#123;</span><br><span class="line">　　　　root: <span class="string">'_'</span>,</span><br><span class="line">　　　　commonjs: <span class="string">'lodash'</span>,</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这个时候加一个root。这个意思是如果既不使用commonjs，也不使用es module。更不用amd形式去引入lodash。这个lodash是通过js引入的，这里要求这个script标签必须注入一个叫做’_’的全局变量。但是一般来说没有特殊要求，直接配置成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">externals : &#123;</span><br><span class="line">　　lodash :<span class="string">'lodash'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>就可以了，他的意思是不管任何环境下，引入lodash都叫做lodash。</p>
<p>最终我们给别人使用的是最后的library,那怎么样让别人方便的使用到呢？<br>首先把package.json里面的入口文件配置改成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"main"</span>: <span class="string">"./dist/library.js"</span>,</span><br></pre></td></tr></table></figure>

<p>然后npm里面注册一个账号。登录后在命令行输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm adduser</span><br></pre></td></tr></table></figure>

<p>输入账号密码后，直接输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure>

<p>成功后，别人利用npm install library就可以用你的了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/28/webpack系列/21webpack中环境变量的使用方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qicainiao">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qicainiao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/28/webpack系列/21webpack中环境变量的使用方法/" itemprop="url">webpack系列-21webpack中环境变量的使用方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-28T18:31:00+08:00">
                2019-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webpack系列/" itemprop="url" rel="index">
                    <span itemprop="name">webpack系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在webpack打包过程中，怎么去使用一些环境变量。<br>首先我有一个打包配置的三个文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"dev-build"</span>: <span class="string">"webpack --profile --json &gt; stats.json --config ./build/webpack.dev.js"</span>,</span><br><span class="line">　　<span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config ./build/webpack.dev.js"</span>,</span><br><span class="line">　　<span class="string">"build"</span>: <span class="string">"webpack --config ./build/webpack.prod.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>对应三个命令，分别是开发环境的一个命令 npm run dev。打包生成开发环境代码的命令 npm run dev-build。以及线上代码生成的一个命令 npm run build。现在我要借助两个配置文件来帮助我们去完成对应的打包，分别是dev对应配置文件和prod对应的配置文件。现在我可以通过另外一种形式来对代码进行一次变更。</p>
<p>webpack.dev.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">const merge = require(<span class="string">'webpack-merge'</span>);</span><br><span class="line">const commonConfig = require(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const devConfig = &#123;　　</span><br><span class="line">　　mode: <span class="string">'development'</span>,</span><br><span class="line">　　devtool: <span class="string">'cheap-module-eval-source-map'</span>,</span><br><span class="line">　　devServer: &#123;</span><br><span class="line">　　　　contentBase:<span class="string">'./dist'</span>,</span><br><span class="line">　　　　open:<span class="literal">true</span>,</span><br><span class="line">　　　　hot: <span class="literal">true</span></span><br><span class="line">　　&#125;,</span><br><span class="line">　　plugins: [</span><br><span class="line">　　　　new webpack.HotModuleReplacementPlugin()</span><br><span class="line">　　],</span><br><span class="line">　　output: &#123;</span><br><span class="line">　　　　filename: <span class="string">'[name].js'</span>,</span><br><span class="line">　　　　chunkFilename: <span class="string">'[name].chunk.js'</span>,</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = merge(commonConfig, devConfig);</span><br></pre></td></tr></table></figure>

<p>这是dev配置原始文件，其中引入了merge和commonConfig。现在我把他删掉，直接导出devConfig</p>
<p>webpack.dev.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">const devConfig = &#123;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = devConfig;</span><br></pre></td></tr></table></figure>

<p>prod也做同样的处理，这样我导出的就不是融合过后的文件。而是自己独立的配置文件。接着我们打开webpack.common.js，去引入merge，dev和prod</p>
<p>webpack.common.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const path = require(<span class="string">'path'</span>);</span><br><span class="line">const HtmlWebpackPlugin = require(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line">const CleanWebpackPlugin = require(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line">const webpack = require(<span class="string">'webpack'</span>);</span><br><span class="line">const merge = require(<span class="string">'webpack-merge'</span>);</span><br><span class="line">const devConfig = require(<span class="string">'./webpack.dev'</span>);</span><br><span class="line">const prodConfig = require(<span class="string">'./webpack.prod'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const commonConfig = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = (env) =&gt; &#123;</span><br><span class="line">　　// 如果有这个全局变量，且是线上环境，否则是开发环境</span><br><span class="line">　　<span class="keyword">if</span>(env &amp;&amp; env.production) &#123;</span><br><span class="line">　　　　<span class="built_in">return</span> merge(commonConfig, prodConfig);</span><br><span class="line">　　&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">　　　　<span class="built_in">return</span> merge(commonConfig, devConfig);</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以前我们导出一个对象，这里我们导出一个函数，接收一个全局变量，怎么融合取决于传递进来的变量。是否有全局变量，是哪个环境决定</p>
<p>package.json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">　　<span class="string">"dev-build"</span>: <span class="string">"webpack --profile --json &gt; stats.json --config ./build/webpack.common.js"</span>,</span><br><span class="line">　　<span class="string">"dev"</span>: <span class="string">"webpack-dev-server --config ./build/webpack.common.js"</span>,</span><br><span class="line">　　<span class="string">"build"</span>: <span class="string">"webpack --env.production --config ./build/webpack.common.js"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>package.json里面走的都是webpack.common.js了。在build里面加入–env.production。其他不加默认走devConfig。各自运行。没问题。这样就不是通过不同的文件，而是都是走common，通过变量控制</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">qicainiao</p>
              <p class="site-description motion-element" itemprop="description">Geek Spirit</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qicainiao</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
